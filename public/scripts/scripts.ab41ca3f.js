"use strict";angular.module("App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngFabForm","ngDraggable"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/games",{templateUrl:"views/games.html",controller:"GamesCtrl",controllerAs:"games"}).when("/game/:gameid",{templateUrl:"views/game.html",controller:"GameCtrl",controllerAs:"game"}).when("/game/:gameid/makecharacter",{templateUrl:"views/game/makecharacter.html",controller:"MakeCharacterCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("App").controller("MainCtrl",["$scope","user",function(a,b){a.user="?",b().then(function(b){a.user=b},function(b){console.log("user err: ",b),a.user=!1})}]),angular.module("App").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("App").service("Games",["$resource","$window",function(a,b){var c="/games";/glitterwood\.com/.test(b.location.host)&&(c="http://glitterwood.com:5000"+c);var d=c+"/:id";return a(c,{id:"@id",creator:"@creator"},{get:{method:"GET",url:d},query:{method:"GET",isArray:!0},destroy:{method:"DELETE",url:d},create:{method:"POST"},people:{method:"GET",url:d+"/people/:creator",isArray:!0}})}]),angular.module("App").controller("GamesCtrl",["$scope","Games","$window","user",function(a,b,c,d){function e(){b.query({creator:a.user.id},function(b){console.log("games returned: ",b),a.games=b})}a.games=[],a.user="?",d().then(function(b){a.user=b,e()},function(b){console.log("user err: ",b),a.user=!1}),a.createGame=function(){return b.create({creator:a.user.id},e),!1},a.play=function(a){c.location="/#game/"+a._id}}]),angular.module("App").controller("GameCtrl",["$scope","$routeParams","$window","Games","user",function(a,b,c,d,e){var f=b.gameid;id||(c.location="/#games"),a.user="?",a.createCharacter=function(){c.location="#/game/"+f+"/makecharacter"},e().then(function(b){a.user=b,d.get({id:f},function(e){a.game=e,d.people({id:e._id,creator:b.id},function(b){b.length?a.people=b:a.createCharacter()},function(a){c.location="#/games"})})},function(a){console.log("user err: ",a),c.location="/#games/"}),a.id=id}]),angular.module("App").controller("MakeCharacterCtrl",["$scope","$routeParams","People","user","$window",function(a,b,c,d,e){var f=b.gameid;a.character={name:"",gender:"?",abilities:[{name:"looks"},{name:"smarts"},{name:"talent"},{name:"energy"},{name:"friendly"}],age:20,game:f},a.user="?",d().then(function(b){a.user=b},function(b){console.log("user err: ",b),a.user=!1}),a.onSubmit=function(b){if(a.user){console.log("submitted",b);var d=_.clone(a.character);d.creator=a.user.id,delete d.abilities,d.playable=!0;var g=5;return d=_.reduce(a.character.abilities,function(a,b){return a[b.name]=g,--g,a},d),c.create(d,function(a){console.log("saved ",a),e.location="/#game/"+f},function(a){console.log("error: ",a)}),!1}},a.resetAbility=function(b,c,d){console.log("resetAbility: ",b),console.log("onto",d);var e;a.character.abilities=_(a.character.abilities).reject(function(a){return a.name===b.name?(e=a,!0):!1}),a.character.abilities=a.character.abilities.map(function(a){return a.name===d.name?[e,a]:a}),a.character.abilities=a.character.abilities.flatten().value()}}]),angular.module("App").service("People",["$resource","$window",function(a,b){var c="/people/:game";/glitterwood\.com/.test(b.location.host)&&(c="http://glitterwood.com:5000"+c);var d=c+"/:id";return a(c,{id:"@id",game:"@game"},{get:{method:"GET",url:d},put:{method:"PUT",url:d},query:{method:"GET",isArray:!0},destroy:{method:"DELETE",url:d},create:{method:"POST"}})}]),angular.module("App").service("user",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("/user.json").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}}]),angular.module("App").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/game.html",'<h1><a href="/">Glitterwood</a>: <a href="/#games">Games</a>: {{ id }} <span ng-if="game"> (created {{ game.date | date }}) </span> </h1> <ul ng-if="people"> <li ng-repeat="person in people"> {{ person._id }}: &quot;{{ person.name }}&quot; </li> </ul> <p><a ng-click="createCharacter()">Create New Avatar</a></p> <p ng-if="user"> Logged in as {{ user.fullName }} <a href="/logout">Log Out</a></p> <p ng-if="user === false"><a href="/login">Log In</a> or <a href="/register">Register</a></p>'),a.put("views/game/makecharacter.html",'<h1><a href="/">Glitterwood</a>: <a href="/#games">Games</a>: {{ id }} <span ng-if="game"> (created {{ game.date | date }}) </span> </h1> <h2>Create a character:</h2> <form ng-submit="onSubmit()"> <div> <label>Name:</label> <input type="text" required ng-minlength="3" ng-maxlength="40" ng-model="character.name"> </div> <fieldset> <legend>Abilities</legend> <p>Arrange your abilities from best to worst</p> <div class="ability-dragger"> <div ng-repeat="ability in character.abilities" class="ability-dragger__target" ng-drop-success="resetAbility($data,$event, ability)" ng-drop="true"> <div ng-drag="true" ng-drag-data="ability" class="ability-dragger__ability"> {{ ability.name }} </div> </div> </div> </fieldset> <div class="button-nav"> <button type="submit">Create</button> </div> </form>'),a.put("views/games.html",'<h1>Glitterwood Games</h1> <p ng-if="user === false"><i>You must be logged into see and create games</i></p> <ul> <li ng-repeat="game in games"> Game {{game._id}}: created {{ game.date | date }} by {{ game.creator }} <button ng-click="play(game)" type="button">Play</button> </li> </ul> <button ng-if="user != \'?\' && user !== false" ng-click="createGame()" type="button"> Create a game </button> <p ng-if="user"> Logged in as {{ user.fullName }} <a href="/logout">Log Out</a></p> <p ng-if="user === false"><a href="/login">Log In</a> or <a href="/register">Register</a></p>'),a.put("views/main.html",'<p> Glitterwood is an angular/easel/canvas game </p> <ul> <li> <a href="#/games">List of Games</a> </li> </ul> <p ng-if="user"> Logged in as {{ user.fullName }} <a href="/logout">Log Out</a></p> <p ng-if="user === false"><a href="/login">Log In</a> or <a href="/register">Register</a></p>')}]);