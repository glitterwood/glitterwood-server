"use strict";angular.module("lumiataFoosballApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","ngMaterial.components","yaru22.angular-timeago","angularMoment"]).constant("MONGOLAB_API_KEY","8uHmSZH355k-nFgXmWDAsHT_GTvmsATk").constant("MONGOLAB_DATABASE","lumiata-foosball").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/players",{templateUrl:"views/players.html",controller:"PlayersCtrl",controllerAs:"players"}).when("/game",{templateUrl:"views/game.html",controller:"GameCtrl",controllerAs:"game"}).when("/history",{templateUrl:"views/history.html",controller:"HistoryCtrl",controllerAs:"history"}).when("/players/:id",{templateUrl:"views/playerticket.html",controller:"PlayerticketCtrl",controllerAs:"playerTicket"}).when("/tournament",{templateUrl:"views/tournament.html",controller:"TournamentCtrl",controllerAs:"tournament"}).otherwise({redirectTo:"/"})}]).controller("AppCtrl",["$scope","$timeout","$mdSidenav","$mdUtil","$log",function(a,b,c,d,e){function f(a){var b=d.debounce(function(){c(a).toggle().then(function(){e.debug("toggle "+a+" is done")})},300);return b}a.toggleLeft=f("left"),a.toggleRight=f("right")}]).controller("LeftCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("left").close().then(function(){d.debug("close LEFT is done")})}}]).controller("RightCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("right").close().then(function(){d.debug("close RIGHT is done")})}}]),angular.module("lumiataFoosballApp").controller("MainCtrl",["$scope","SimSize",function(a,b){a.width=600,a.height=400;var c=new b(".view-frame");c.on("resize",function(b){a.width=Math.max(400,.8*b.width),a.height=Math.min(.8*b.width,.5*b.height)}),a.sizer=c}]),angular.module("lumiataFoosballApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("lumiataFoosballApp").controller("PlayersCtrl",["$scope","Players","$mdDialog","lodash","$timeout",function(a,b,c,d,e){function f(){b.query(function(b){a.players=b,d.each(b,function(a){if(a.avatar)try{a.avatarImage=new Image,a.avatarImage.src=a.avatar}catch(b){a.avatarImage=null}})})}function g(){if(!a.playersText)return void(a.multiPlayers=[]);var b=a.playersText.split("\n");a.multiPlayers=d(b).map(function(a){return a.split(",")}).flatten().map(d.trim).select(function(a){return/^[ \w]+$/.test(a)}).compact().uniq().value()}a.newPlayer=null;var h=1;a.players=[],f(),a.resetPlayerForm=function(){var a=angular.element("[name=newPlayerForm")[0];a&&a.reset()};var i=d.debounce(g,1200);a.$watch("playersText",i),a.addPlayers=function(){g(),e(function(){c.show(c.confirm().parent(angular.element(document.body)).title("Create multiple players").content("Create "+a.multiPlayers.length+" players?").ok("Yes").cancel("Cancel")).then(function(){b.addMany({names:a.multiPlayers},f)})},1500)},a.destroyPlayers=function(){c.show(c.confirm().parent(angular.element(document.body)).title("Destroy ALL PLAYERS AND GAMES").content("Destroy ALL players and their games").ok("BRING IT ALL DOWN").cancel("Cancel")).then(function(){b.destroy({},f)})},a.createPlayer=function(){a.resetPlayerForm(),a.newPlayer={name:"",id:++h}},a.updatePlayersText=i,a.playersText="",a.createPlayer(),a.addPlayer=function(){a.newPlayer&&a.newPlayer.name&&(a.avatar&&(a.newPlayer.avatar=a.avatar),b.save(a.newPlayer,f,function(a){409===a.status?c.show(c.alert().parent(angular.element(document.body)).title("Duplicate Record").content('There is already a user by the name of "'+a.data.name+'".').ok("Thanks")):413===a.status&&c.show(c.alert().parent(angular.element(document.body)).title("Icon too big").content("Please use a smaller avatar image.").ok("Thanks"))}),a.createPlayer())}}]),angular.module("lumiataFoosballApp").service("Players",["$resource","$window",function(a,b){var c="/players";return/lumiata-foosball.com/.test(b.location.host)&&(c="http://lumiata-foosball.com:5000"+c),a(c,{id:"@id"},{query:{method:"GET",isArray:!0},get:{method:"GET",url:c+"/:id",params:{id:"@id"}},destroy:{method:"DELETE",url:c+"/all"},addMany:{method:"POST",url:c+"/many",isArray:!0}})}]),angular.module("lumiataFoosballApp").controller("GameCtrl",function(){}),angular.module("lumiataFoosballApp").directive("foosballTable",["SimSize","Games","lodash","$mdToast",function(a,b,c,d){return{templateUrl:"/views/foosballTable.html",restrict:"E",link:function(e,f){function g(){return[{number:1,player:"(none)"},{number:2,player:"(none)"},{number:3,player:"(none)"}]}function h(a){return c.reject(a,function(a){return"(none)"===a.player}).length}function i(){var a=e.topSlots.concat(e.bottomSlots),b=c.groupBy(a,function(a){return a.player});c.each(b,function(a,c){b[c]=a.length}),e.saveable=h(e.topSlots)&&h(e.bottomSlots),c.each(a,function(a){if("(none)"!==a.player){var c=b[a.player];1===c?a.duplicate&&(a.duplicate=!1):(e.saveable=!1,a.duplicate||(a.duplicate=!0))}})}e.topSlots=g(),e.bottomSlots=g(),e.$applyAsync(function(){var b=new a(".view-frame");b.on("resize",function(a){f.find(".foosball-frame").css("width",a.width+"px").css("height",a.height+"px")})}),e.updateGame=i,e.$watch("topSlots[0].player",i("top")),e.$watch("topSlots[1].player",i("top")),e.$watch("topSlots[2].player",i("top")),e.$watch("bottomSlots[0].player",i("bottom")),e.$watch("bottomSlots[1].player",i("bottom")),e.$watch("bottomSlots[2].player",i("bottom")),e.saveGame=function(){b.add({team1:c.pluck(e.topSlots,"player"),team2:c.pluck(e.bottomSlots,"player"),winner:e.winningTeamNumber},function(){d.show(d.simple().content("Game Saved!").position("top right").hideDelay(3e3))}),e.topSlots=g(),e.bottomSlots=g(),e.selectTeam(0)},e.winClass=function(a){return e.winningTeamNumber?e.winningTeamNumber===a?"selected":"unselected":""},e.winClass1="default",e.winClass2="default",e.selectTeam=function(a){a===e.winningTeamNumber?(e.winningTeamNumber=0,e.winClass1=e.winClass2=""):(e.winningTeamNumber=a,e.winClass1=1===a?"selected":"unselected",e.winClass2=2===a?"selected":"unselected")}}}}]),angular.module("lumiataFoosballApp").service("SimSize",["EventEmitter","lodash","$window","$document","$timeout",function(a,b,c,d,e){function f(a,d){this.width=this.height=0,this.elementName=a;var f=this;this._resize=d?b.debounce(function(){return f.resize()}):function(){return f.resize()},this.win=angular.element(c),this.win.on("resize",this._resize),e(function(){f.resize()},0)}return f.prototype=Object.create(a.prototype),b.extend(f.prototype,{destroy:function(){this.win.off("resize",this._resize)},target:function(){return d.find(this.elementName)},resize:function(){var a=this.target();a[0]||this.destroy();var c=a.width(),d=a.height();(c!==this.width||d!==this.height)&&(this.width=c,this.height=d,this.emit("resize",b.pick(this,["width","height"])))}}),f}]),angular.module("lumiataFoosballApp").service("EventEmitter",function(){function a(){a.init.call(this)}var b=angular;return a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.init=function(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(a){if(!b.isNumber(a)||0>a||isNaN(a))throw new Error("n must be a positive number");return this._maxListeners=a,this},a.prototype.emit=function(a){var c,d,e,f,g,h;if(this._events||(this._events={}),"error"===a&&!this._events.error)throw c=arguments[1],c instanceof Error?c:Error('Uncaught, unspecified "error" event.');if(d=this._events[a],b.isUndefined(d))return!1;if(b.isFunction(d))switch(arguments.length){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,f=new Array(e-1),g=1;e>g;g++)f[g-1]=arguments[g];d.apply(this,f)}else if(b.isObject(d)){for(e=arguments.length,f=new Array(e-1),g=1;e>g;g++)f[g-1]=arguments[g];for(h=d.slice(),e=h.length,g=0;e>g;g++)h[g].apply(this,f)}return!0},a.prototype.addListener=function(c,d){var e;if(!b.isFunction(d))throw new Error("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",c,b.isFunction(d.listener)?d.listener:d),this._events[c]?b.isObject(this._events[c])?this._events[c].push(d):this._events[c]=[this._events[c],d]:this._events[c]=d,b.isObject(this._events[c])&&!this._events[c].warned&&(e=b.isUndefined(this._maxListeners)?a.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[c].length>e&&(this._events[c].warned=!0,b.isFunction(console.error)&&console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[c].length),b.isFunction(console.trace)&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(a,c){function d(){f.removeListener(a,d),e||(e=!0,c.apply(f,arguments))}if(!b.isFunction(c))throw new Error("listener must be a function");var e=!1,f=this;return d.listener=c,this.on(a,d),this},a.prototype.removeListener=function(a,c){var d,e,f,g;if(!b.isFunction(c))throw new Error("listener must be a function");if(!this._events||!this._events[a])return this;if(d=this._events[a],f=d.length,e=-1,d===c||b.isFunction(d.listener)&&d.listener===c)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,c);else if(b.isObject(d)){for(g=f;g-->0;)if(d[g]===c||d[g].listener&&d[g].listener===c){e=g;break}if(0>e)return this;1===d.length?(d.length=0,delete this._events[a]):d.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,c)}return this},a.prototype.removeAllListeners=function(a){var c,d;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(c in this._events)"removeListener"!==c&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events={},this}if(d=this._events[a],b.isFunction(d))this.removeListener(a,d);else if(Array.isArray(d))for(;d.length;)this.removeListener(a,d[d.length-1]);return delete this._events[a],this},a.prototype.listeners=function(a){var c;return c=this._events&&this._events[a]?b.isFunction(this._events[a])?[this._events[a]]:this._events[a].slice():[]},a.listenerCount=function(a,c){var d;return d=a._events&&a._events[c]?b.isFunction(a._events[c])?1:a._events[c].length:0},a}),angular.module("lumiataFoosballApp").service("lodash",function(){return function(){function a(a,b){if(a!==b){var c=null===a,d=a===t,e=a===a,f=null===b,g=b===t,h=b===b;if(a>b&&!f||!e||c&&!g&&h||d&&h)return 1;if(b>a&&!c||!h||f&&!d&&e||g&&e)return-1}return 0}function b(a,b,c){for(var d=a.length,e=c?d:-1;c?e--:++e<d;)if(b(a[e],e,a))return e;return-1}function c(a,b,c){if(b!==b)return l(a,c);c-=1;for(var d=a.length;++c<d;)if(a[c]===b)return c;return-1}function d(a){return"function"==typeof a||!1}function e(a){return"string"==typeof a?a:null==a?"":a+""}function f(a,b){for(var c=-1,d=a.length;++c<d&&-1<b.indexOf(a.charAt(c)););return c}function g(a,b){for(var c=a.length;c--&&-1<b.indexOf(a.charAt(c)););return c}function h(b,c){return a(b.a,c.a)||b.b-c.b}function i(a){return Ja[a]}function j(a){return Ka[a]}function k(a){return"\\"+Na[a]}function l(a,b,c){var d=a.length;for(b+=c?0:-1;c?b--:++b<d;){var e=a[b];if(e!==e)return b}return-1}function m(a){return!!a&&"object"==typeof a}function n(a){return 160>=a&&a>=9&&13>=a||32==a||160==a||5760==a||6158==a||a>=8192&&(8202>=a||8232==a||8233==a||8239==a||8287==a||12288==a||65279==a)}function o(a,b){for(var c=-1,d=a.length,e=-1,f=[];++c<d;)a[c]===b&&(a[c]=M,f[++e]=c);return f}function p(a){for(var b=-1,c=a.length;++b<c&&n(a.charCodeAt(b)););return b}function q(a){for(var b=a.length;b--&&n(a.charCodeAt(b)););return b}function r(a){return La[a]}function s(n){function Ja(a){if(m(a)&&!(Ef(a)||a instanceof Ma)){if(a instanceof La)return a;if(ae.call(a,"__chain__")&&ae.call(a,"__wrapped__"))return Nc(a)}return new La(a)}function Ka(){}function La(a,b,c){this.__wrapped__=a,this.__actions__=c||[],this.__chain__=!!b}function Ma(a){this.__wrapped__=a,this.__actions__=null,this.__dir__=1,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=Ce,this.__views__=null}function Na(){this.__data__={}}function Oa(a){var b=a?a.length:0;for(this.data={hash:se(null),set:new me};b--;)this.push(a[b])}function Pa(a,b){var c=a.data;return("string"==typeof b||od(b)?c.set.has(b):c.hash[b])?0:-1}function Qa(a,b){var c=-1,d=a.length;for(b||(b=Nd(d));++c<d;)b[c]=a[c];return b}function Ra(a,b){for(var c=-1,d=a.length;++c<d&&!1!==b(a[c],c,a););return a}function Sa(a,b){for(var c=-1,d=a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}function Va(a,b){for(var c=-1,d=a.length,e=-1,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[++e]=g)}return f}function Wa(a,b){for(var c=-1,d=a.length,e=Nd(d);++c<d;)e[c]=b(a[c],c,a);return e}function Xa(a,b,c,d){var e=-1,f=a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function Ya(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function Za(a,b){return a===t?b:a}function $a(a,b,c,d){return a!==t&&ae.call(d,c)?a:b}function _a(a,b,c){for(var d=-1,e=Qf(b),f=e.length;++d<f;){var g=e[d],h=a[g],i=c(h,b[g],g,a,b);(i===i?i===h:h!==h)&&(h!==t||g in a)||(a[g]=i)}return a}function ab(a,b){return null==b?a:cb(b,Qf(b),a)}function bb(a,b){for(var c=-1,d=null==a,e=!d&&Ac(a),f=e?a.length:0,g=b.length,h=Nd(g);++c<g;){var i=b[c];h[c]=e?Bc(i,f)?a[i]:t:d?t:a[i]}return h}function cb(a,b,c){c||(c={});for(var d=-1,e=b.length;++d<e;){var f=b[d];c[f]=a[f]}return c}function db(a,b,c){var d=typeof a;return"function"==d?b===t?a:Nb(a,b,c):null==a?Id:"object"==d?ub(a):b===t?Md(a):vb(a,b)}function eb(a,b,c,d,e,f,g){var h;if(c&&(h=e?c(a,d,e):c(a)),h!==t)return h;if(!od(a))return a;if(d=Ef(a)){if(h=wc(a),!b)return Qa(a,h)}else{var i=ce.call(a),j=i==S;if(i!=U&&i!=N&&(!j||e))return Ha[i]?yc(a,i,b):e?a:{};if(h=xc(j?{}:a),!b)return ab(h,a)}for(f||(f=[]),g||(g=[]),e=f.length;e--;)if(f[e]==a)return g[e];return f.push(a),g.push(h),(d?Ra:nb)(a,function(d,e){h[e]=eb(d,b,c,e,a,f,g)}),h}function fb(a,b,c){if("function"!=typeof a)throw new Wd(L);return ne(function(){a.apply(t,c)},b)}function gb(a,b){var d=a?a.length:0,e=[];if(!d)return e;var f=-1,g=tc(),h=g==c,i=h&&200<=b.length?Qe(b):null,j=b.length;i&&(g=Pa,h=!1,b=i);a:for(;++f<d;)if(i=a[f],h&&i===i){for(var k=j;k--;)if(b[k]===i)continue a;e.push(i)}else 0>g(b,i,0)&&e.push(i);return e}function hb(a,b){var c=!0;return Le(a,function(a,d,e){return c=!!b(a,d,e)}),c}function ib(a,b,c,d){var e=d,f=e;return Le(a,function(a,g,h){g=+b(a,g,h),(c(g,e)||g===d&&g===f)&&(e=g,f=a)}),f}function jb(a,b){var c=[];return Le(a,function(a,d,e){b(a,d,e)&&c.push(a)}),c}function kb(a,b,c,d){var e;return c(a,function(a,c,f){return b(a,c,f)?(e=d?c:a,!1):void 0}),e}function lb(a,b,c){for(var d=-1,e=a.length,f=-1,g=[];++d<e;){var h=a[d];if(m(h)&&Ac(h)&&(c||Ef(h)||kd(h))){b&&(h=lb(h,b,c));for(var i=-1,j=h.length;++i<j;)g[++f]=h[i]}else c||(g[++f]=h)}return g}function mb(a,b){Ne(a,b,xd)}function nb(a,b){return Ne(a,b,Qf)}function ob(a,b){return Oe(a,b,Qf)}function pb(a,b){for(var c=-1,d=b.length,e=-1,f=[];++c<d;){var g=b[c];Gf(a[g])&&(f[++e]=g)}return f}function qb(a,b,c){if(null!=a){c!==t&&c in Lc(a)&&(b=[c]),c=0;for(var d=b.length;null!=a&&d>c;)a=a[b[c++]];return c&&c==d?a:t}}function rb(a,b,c,d,e,f){if(a===b)a=!0;else if(null==a||null==b||!od(a)&&!od(b))a=a!==a&&b!==b;else a:{var g=rb,h=Ef(a),i=Ef(b),j=O,k=O;h||(j=ce.call(a),j==N?j=U:j!=U&&(h=td(a))),i||(k=ce.call(b),k==N?k=U:k!=U&&td(b));var l=j==U,i=k==U,k=j==k;if(!k||h||l){if(!d&&(j=l&&ae.call(a,"__wrapped__"),i=i&&ae.call(b,"__wrapped__"),j||i)){a=g(j?a.value():a,i?b.value():b,c,d,e,f);break a}if(k){for(e||(e=[]),f||(f=[]),j=e.length;j--;)if(e[j]==a){a=f[j]==b;break a}e.push(a),f.push(b),a=(h?oc:qc)(a,b,g,c,d,e,f),e.pop(),f.pop()}else a=!1}else a=pc(a,b,j)}return a}function sb(a,b,c){var d=b.length,e=d,f=!c;if(null==a)return!e;for(a=Lc(a);d--;){var g=b[d];if(f&&g[2]?g[1]!==a[g[0]]:!(g[0]in a))return!1}for(;++d<e;){var g=b[d],h=g[0],i=a[h],j=g[1];if(f&&g[2]){if(i===t&&!(h in a))return!1}else if(g=c?c(i,j,h):t,g===t?!rb(j,i,c,!0):!g)return!1}return!0}function tb(a,b){var c=-1,d=Ac(a)?Nd(a.length):[];return Le(a,function(a,e,f){d[++c]=b(a,e,f)}),d}function ub(a){var b=uc(a);if(1==b.length&&b[0][2]){var c=b[0][0],d=b[0][1];return function(a){return null==a?!1:a[c]===d&&(d!==t||c in Lc(a))}}return function(a){return sb(a,b)}}function vb(a,b){var c=Ef(a),d=Dc(a)&&b===b&&!od(b),e=a+"";return a=Mc(a),function(f){if(null==f)return!1;var g=e;if(f=Lc(f),!(!c&&d||g in f)){if(f=1==a.length?f:qb(f,Cb(a,0,-1)),null==f)return!1;g=Sc(a),f=Lc(f)}return f[g]===b?b!==t||g in f:rb(b,f[g],t,!0)}}function wb(a,b,c,d,e){if(!od(a))return a;var f=Ac(b)&&(Ef(b)||td(b)),g=f?null:Qf(b);return Ra(g||b,function(h,i){if(g&&(i=h,h=b[i]),m(h)){d||(d=[]),e||(e=[]);a:{for(var j=i,k=d,l=e,n=k.length,o=b[j];n--;)if(k[n]==o){a[j]=l[n];break a}var n=a[j],p=c?c(n,o,j,a,b):t,q=p===t;q&&(p=o,Ac(o)&&(Ef(o)||td(o))?p=Ef(n)?n:Ac(n)?Qa(n):[]:Hf(o)||kd(o)?p=kd(n)?vd(n):Hf(n)?n:{}:q=!1),k.push(o),l.push(p),q?a[j]=wb(p,o,c,k,l):(p===p?p!==n:n===n)&&(a[j]=p)}}else j=a[i],k=c?c(j,h,i,a,b):t,(l=k===t)&&(k=h),k===t&&(!f||i in a)||!l&&(k===k?k===j:j!==j)||(a[i]=k)}),a}function xb(a){return function(b){return null==b?t:b[a]}}function yb(a){var b=a+"";return a=Mc(a),function(c){return qb(c,a,b)}}function zb(a,b){for(var c=a?b.length:0;c--;){var d=b[c];if(d!=e&&Bc(d)){var e=d;oe.call(a,d,1)}}}function Ab(a,b){return a+je(Be()*(b-a+1))}function Bb(a,b,c,d,e){return e(a,function(a,e,f){c=d?(d=!1,a):b(c,a,e,f)}),c}function Cb(a,b,c){var d=-1,e=a.length;for(b=null==b?0:+b||0,0>b&&(b=-b>e?0:e+b),c=c===t||c>e?e:+c||0,0>c&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0,c=Nd(e);++d<e;)c[d]=a[d+b];return c}function Db(a,b){var c;return Le(a,function(a,d,e){return c=b(a,d,e),!c}),!!c}function Eb(a,b){var c=a.length;for(a.sort(b);c--;)a[c]=a[c].c;return a}function Fb(b,c,d){var e=rc(),f=-1;return c=Wa(c,function(a){return e(a)}),b=tb(b,function(a){return{a:Wa(c,function(b){return b(a)}),b:++f,c:a}}),Eb(b,function(b,c){var e;a:{e=-1;for(var f=b.a,g=c.a,h=f.length,i=d.length;++e<h;){var j=a(f[e],g[e]);if(j){e=i>e?j*(d[e]?1:-1):j;break a}}e=b.b-c.b}return e})}function Gb(a,b){var c=0;return Le(a,function(a,d,e){c+=+b(a,d,e)||0}),c}function Hb(a,b){var d=-1,e=tc(),f=a.length,g=e==c,h=g&&f>=200,i=h?Qe():null,j=[];i?(e=Pa,g=!1):(h=!1,i=b?[]:j);a:for(;++d<f;){var k=a[d],l=b?b(k,d,a):k;if(g&&k===k){for(var m=i.length;m--;)if(i[m]===l)continue a;b&&i.push(l),j.push(k)}else 0>e(i,l,0)&&((b||h)&&i.push(l),j.push(k))}return j}function Ib(a,b){for(var c=-1,d=b.length,e=Nd(d);++c<d;)e[c]=a[b[c]];return e}function Jb(a,b,c,d){for(var e=a.length,f=d?e:-1;(d?f--:++f<e)&&b(a[f],f,a););return c?Cb(a,d?0:f,d?f+1:e):Cb(a,d?f+1:0,d?e:f)}function Kb(a,b){var c=a;c instanceof Ma&&(c=c.value());for(var d=-1,e=b.length;++d<e;){var c=[c],f=b[d];le.apply(c,f.args),c=f.func.apply(f.thisArg,c)}return c}function Lb(a,b,c){var d=0,e=a?a.length:d;if("number"==typeof b&&b===b&&Ee>=e){for(;e>d;){var f=d+e>>>1,g=a[f];(c?b>=g:b>g)&&null!==g?d=f+1:e=f}return e}return Mb(a,b,Id,c)}function Mb(a,b,c,d){b=c(b);for(var e=0,f=a?a.length:0,g=b!==b,h=null===b,i=b===t;f>e;){var j=je((e+f)/2),k=c(a[j]),l=k!==t,m=k===k;(g?m||d:h?m&&l&&(d||null!=k):i?m&&(d||l):null==k?0:d?b>=k:b>k)?e=j+1:f=j}return xe(f,De)}function Nb(a,b,c){if("function"!=typeof a)return Id;if(b===t)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}function Ob(a){return ge.call(a,0)}function Pb(a,b,c){for(var d=c.length,e=-1,f=we(a.length-d,0),g=-1,h=b.length,i=Nd(f+h);++g<h;)i[g]=b[g];for(;++e<d;)i[c[e]]=a[e];for(;f--;)i[g++]=a[e++];return i}function Qb(a,b,c){for(var d=-1,e=c.length,f=-1,g=we(a.length-e,0),h=-1,i=b.length,j=Nd(g+i);++f<g;)j[f]=a[f];for(g=f;++h<i;)j[g+h]=b[h];for(;++d<e;)j[g+c[d]]=a[f++];return j}function Rb(a,b){return function(c,d,e){var f=b?b():{};if(d=rc(d,e,3),Ef(c)){e=-1;for(var g=c.length;++e<g;){var h=c[e];a(f,h,d(h,e,c),c)}}else Le(c,function(b,c,e){a(f,b,d(b,c,e),e)});return f}}function Sb(a){return id(function(b,c){var d=-1,e=null==b?0:c.length,f=e>2?c[e-2]:t,g=e>2?c[2]:t,h=e>1?c[e-1]:t;for("function"==typeof f?(f=Nb(f,h,5),e-=2):(f="function"==typeof h?h:t,e-=f?1:0),g&&Cc(c[0],c[1],g)&&(f=3>e?t:f,e=1);++d<e;)(g=c[d])&&a(b,g,f);return b})}function Tb(a,b){return function(c,d){var e=c?Se(c):0;if(!Fc(e))return a(c,d);for(var f=b?e:-1,g=Lc(c);(b?f--:++f<e)&&!1!==d(g[f],f,g););return c}}function Ub(a){return function(b,c,d){var e=Lc(b);d=d(b);for(var f=d.length,g=a?f:-1;a?g--:++g<f;){var h=d[g];if(!1===c(e[h],h,e))break}return b}}function Vb(a,b){function c(){return(this&&this!==Ta&&this instanceof c?d:a).apply(b,arguments)}var d=Xb(a);return c}function Wb(a){return function(b){var c=-1;b=Fd(Ad(b));for(var d=b.length,e="";++c<d;)e=a(e,b[c],c);return e}}function Xb(a){return function(){var b=arguments;switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4])}var c=Ke(a.prototype),b=a.apply(c,b);return od(b)?b:c}}function Yb(a){function b(c,d,e){return e&&Cc(c,d,e)&&(d=null),c=nc(c,a,null,null,null,null,null,d),c.placeholder=b.placeholder,c}return b}function Zb(a,b){return function(c,d,e){if(e&&Cc(c,d,e)&&(d=null),d=rc(d,e,3),1==d.length){e=c=Kc(c);for(var f=d,g=-1,h=e.length,i=b,j=i;++g<h;){var k=e[g],l=+f(k);a(l,i)&&(i=l,j=k)}if(e=j,!c.length||e!==b)return e}return ib(c,d,a,b)}}function $b(a,c){return function(d,e,f){return e=rc(e,f,3),Ef(d)?(e=b(d,e,c),e>-1?d[e]:t):kb(d,e,a)}}function _b(a){return function(c,d,e){return c&&c.length?(d=rc(d,e,3),b(c,d,a)):-1}}function ac(a){return function(b,c,d){return c=rc(c,d,3),kb(b,c,a,!0)}}function bc(a){return function(){for(var b,c=arguments.length,d=a?c:-1,e=0,f=Nd(c);a?d--:++d<c;){var g=f[e++]=arguments[d];if("function"!=typeof g)throw new Wd(L);!b&&La.prototype.thru&&"wrapper"==sc(g)&&(b=new La([]))}for(d=b?-1:c;++d<c;){var g=f[d],e=sc(g),h="wrapper"==e?Re(g):null;b=h&&Ec(h[0])&&h[1]==(C|y|A|D)&&!h[4].length&&1==h[9]?b[sc(h[0])].apply(b,h[3]):1==g.length&&Ec(g)?b[e]():b.thru(g)}return function(){var a=arguments;if(b&&1==a.length&&Ef(a[0]))return b.plant(a[0]).value();for(var d=0,a=c?f[d].apply(this,a):a[0];++d<c;)a=f[d].call(this,a);return a}}}function cc(a,b){return function(c,d,e){return"function"==typeof d&&e===t&&Ef(c)?a(c,d):b(c,Nb(d,e,3))}}function dc(a){return function(b,c,d){return("function"!=typeof c||d!==t)&&(c=Nb(c,d,3)),a(b,c,xd)}}function ec(a){return function(b,c,d){return("function"!=typeof c||d!==t)&&(c=Nb(c,d,3)),a(b,c)}}function fc(a){return function(b,c,d){var e={};return c=rc(c,d,3),nb(b,function(b,d,f){f=c(b,d,f),d=a?f:d,b=a?b:f,e[d]=b}),e}}function gc(a){return function(b,c,d){return b=e(b),(a?b:"")+kc(b,c,d)+(a?"":b)}}function hc(a){var b=id(function(c,d){var e=o(d,b.placeholder);return nc(c,a,null,d,e)});return b}function ic(a,b){return function(c,d,e,f){var g=3>arguments.length;return"function"==typeof d&&f===t&&Ef(c)?a(c,d,e,g):Bb(c,rc(d,f,4),e,g,b)}}function jc(a,b,c,d,e,f,g,h,i,j){function k(){for(var u=arguments.length,x=u,y=Nd(u);x--;)y[x]=arguments[x];if(d&&(y=Pb(y,d,e)),f&&(y=Qb(y,f,g)),p||r){var x=k.placeholder,z=o(y,x),u=u-z.length;if(j>u){var C=h?Qa(h):null,u=we(j-u,0),D=p?z:null,z=p?null:z,E=p?y:null,y=p?null:y;return b|=p?A:B,b&=~(p?B:A),q||(b&=~(v|w)),y=[a,b,c,E,D,y,z,C,i,u],C=jc.apply(t,y),Ec(a)&&Te(C,y),C.placeholder=x,C}}if(x=m?c:this,C=n?x[a]:a,h)for(u=y.length,D=xe(h.length,u),z=Qa(y);D--;)E=h[D],y[D]=Bc(E,u)?z[E]:t;return l&&i<y.length&&(y.length=i),this&&this!==Ta&&this instanceof k&&(C=s||Xb(a)),C.apply(x,y)}var l=b&C,m=b&v,n=b&w,p=b&y,q=b&x,r=b&z,s=n?null:Xb(a);return k}function kc(a,b,c){return a=a.length,b=+b,b>a&&ue(b)?(b-=a,c=null==c?" ":c+"",Dd(c,he(b/c.length)).slice(0,b)):""}function lc(a,b,c,d){function e(){for(var b=-1,h=arguments.length,i=-1,j=d.length,k=Nd(h+j);++i<j;)k[i]=d[i];for(;h--;)k[i++]=arguments[++b];return(this&&this!==Ta&&this instanceof e?g:a).apply(f?c:this,k)}var f=b&v,g=Xb(a);return e}function mc(a){return function(b,c,d,e){var f=rc(d);return null==d&&f===db?Lb(b,c,a):Mb(b,c,f(d,e,1),a)}}function nc(a,b,c,d,e,f,g,h){var i=b&w;if(!i&&"function"!=typeof a)throw new Wd(L);var j=d?d.length:0;if(j||(b&=~(A|B),d=e=null),j-=e?e.length:0,b&B){var k=d,l=e;d=e=null}var m=i?null:Re(a);return c=[a,b,c,d,e,k,l,f,g,h],m&&(d=c[1],b=m[1],h=d|b,e=b==C&&d==y||b==C&&d==D&&c[7].length<=m[8]||b==(C|D)&&d==y,(C>h||e)&&(b&v&&(c[2]=m[2],h|=d&v?0:x),(d=m[3])&&(e=c[3],c[3]=e?Pb(e,d,m[4]):Qa(d),c[4]=e?o(c[3],M):Qa(m[4])),(d=m[5])&&(e=c[5],c[5]=e?Qb(e,d,m[6]):Qa(d),c[6]=e?o(c[5],M):Qa(m[6])),(d=m[7])&&(c[7]=Qa(d)),b&C&&(c[8]=null==c[8]?m[8]:xe(c[8],m[8])),null==c[9]&&(c[9]=m[9]),c[0]=m[0],c[1]=h),b=c[1],h=c[9]),c[9]=null==h?i?0:a.length:we(h-j,0)||0,(m?Pe:Te)(b==v?Vb(c[0],c[2]):b!=A&&b!=(v|A)||c[4].length?jc.apply(t,c):lc.apply(t,c),c)}function oc(a,b,c,d,e,f,g){var h=-1,i=a.length,j=b.length;if(i!=j&&(!e||i>=j))return!1;for(;++h<i;){var k=a[h],j=b[h],l=d?d(e?j:k,e?k:j,h):t;if(l!==t){if(l)continue;return!1}if(e){if(!Ya(b,function(a){return k===a||c(k,a,d,e,f,g)}))return!1}else if(k!==j&&!c(k,j,d,e,f,g))return!1}return!0}function pc(a,b,c){switch(c){case P:case Q:return+a==+b;case R:return a.name==b.name&&a.message==b.message;case T:return a!=+a?b!=+b:a==+b;case V:case W:return a==b+""}return!1}function qc(a,b,c,d,e,f,g){var h=Qf(a),i=h.length,j=Qf(b).length;if(i!=j&&!e)return!1;for(j=i;j--;){var k=h[j];if(!(e?k in b:ae.call(b,k)))return!1}for(var l=e;++j<i;){var k=h[j],m=a[k],n=b[k],o=d?d(e?n:m,e?m:n,k):t;if(o===t?!c(m,n,d,e,f,g):!o)return!1;l||(l="constructor"==k)}return l||(c=a.constructor,d=b.constructor,!(c!=d&&"constructor"in a&&"constructor"in b)||"function"==typeof c&&c instanceof c&&"function"==typeof d&&d instanceof d)?!0:!1}function rc(a,b,c){var d=Ja.callback||Gd,d=d===Gd?db:d;return c?d(a,b,c):d}function sc(a){for(var b=a.name,c=Ie[b],d=c?c.length:0;d--;){var e=c[d],f=e.func;if(null==f||f==a)return e.name}return b}function tc(a,b,d){var e=Ja.indexOf||Rc,e=e===Rc?c:e;return a?e(a,b,d):e}function uc(a){a=yd(a);for(var b=a.length;b--;){var c=a[b][1];a[b][2]=c===c&&!od(c)}return a}function vc(a,b){var c=null==a?t:a[b];return pd(c)?c:t}function wc(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&ae.call(a,"index")&&(c.index=a.index,c.input=a.input),c}function xc(a){return a=a.constructor,"function"==typeof a&&a instanceof a||(a=Td),new a}function yc(a,b,c){var d=a.constructor;switch(b){case X:return Ob(a);case P:case Q:return new d(+a);case Y:case Z:case $:case _:case aa:case ba:case ca:case da:case ea:return b=a.buffer,new d(c?Ob(b):b,a.byteOffset,a.length);case T:case W:return new d(a);case V:var e=new d(a.source,xa.exec(a));e.lastIndex=a.lastIndex}return e}function zc(a,b,c){return null==a||Dc(b,a)||(b=Mc(b),a=1==b.length?a:qb(a,Cb(b,0,-1)),b=Sc(b)),b=null==a?a:a[b],null==b?t:b.apply(a,c)}function Ac(a){return null!=a&&Fc(Se(a))}function Bc(a,b){return a="number"==typeof a?a:parseFloat(a),b=null==b?Ge:b,a>-1&&0==a%1&&b>a}function Cc(a,b,c){if(!od(c))return!1;var d=typeof b;return("number"==d?Ac(c)&&Bc(b,c.length):"string"==d&&b in c)?(b=c[b],a===a?a===b:b!==b):!1}function Dc(a,b){var c=typeof a;return"string"==c&&qa.test(a)||"number"==c?!0:Ef(a)?!1:!pa.test(a)||null!=b&&a in Lc(b)}function Ec(a){var b=sc(a);return!!b&&a===Ja[b]&&b in Ma.prototype}function Fc(a){return"number"==typeof a&&a>-1&&0==a%1&&Ge>=a}function Gc(a,b){a=Lc(a);for(var c=-1,d=b.length,e={};++c<d;){var f=b[c];f in a&&(e[f]=a[f])}return e}function Hc(a,b){var c={};return mb(a,function(a,d,e){b(a,d,e)&&(c[d]=a)}),c}function Ic(a){var b;if(!m(a)||ce.call(a)!=U||!(ae.call(a,"constructor")||(b=a.constructor,"function"!=typeof b||b instanceof b)))return!1;var c;return mb(a,function(a,b){c=b}),c===t||ae.call(a,c)}function Jc(a){for(var b=xd(a),c=b.length,d=c&&a.length,e=!!d&&Fc(d)&&(Ef(a)||kd(a)),f=-1,g=[];++f<c;){var h=b[f];(e&&Bc(h,d)||ae.call(a,h))&&g.push(h)}return g}function Kc(a){return null==a?[]:Ac(a)?od(a)?a:Td(a):zd(a)}function Lc(a){return od(a)?a:Td(a)}function Mc(a){if(Ef(a))return a;var b=[];return e(a).replace(ra,function(a,c,d,e){b.push(d?e.replace(va,"$1"):c||a)}),b}function Nc(a){return a instanceof Ma?a.clone():new La(a.__wrapped__,a.__chain__,Qa(a.__actions__))}function Oc(a,b,c){return a&&a.length?((c?Cc(a,b,c):null==b)&&(b=1),Cb(a,0>b?0:b)):[]}function Pc(a,b,c){var d=a?a.length:0;return d?((c?Cc(a,b,c):null==b)&&(b=1),b=d-(+b||0),Cb(a,0,0>b?0:b)):[]}function Qc(a){return a?a[0]:t}function Rc(a,b,d){var e=a?a.length:0;if(!e)return-1;if("number"==typeof d)d=0>d?we(e+d,0):d;else if(d)return d=Lb(a,b),a=a[d],(b===b?b===a:a!==a)?d:-1;return c(a,b,d||0)}function Sc(a){var b=a?a.length:0;return b?a[b-1]:t}function Tc(a){return Oc(a,1)}function Uc(a,b,d,e){if(!a||!a.length)return[];null!=b&&"boolean"!=typeof b&&(e=d,d=Cc(a,b,e)?null:b,b=!1);var f=rc();if((null!=d||f!==db)&&(d=f(d,e,3)),b&&tc()==c){b=d;var g;d=-1,e=a.length;for(var f=-1,h=[];++d<e;){var i=a[d],j=b?b(i,d,a):i;d&&g===j||(g=j,h[++f]=i)}a=h}else a=Hb(a,d);return a}function Vc(a){if(!a||!a.length)return[];var b=-1,c=0;a=Va(a,function(a){return Ac(a)?(c=we(a.length,c),!0):void 0});for(var d=Nd(c);++b<c;)d[b]=Wa(a,xb(b));return d}function Wc(a,b,c){return a&&a.length?(a=Vc(a),null==b?a:(b=Nb(b,c,4),Wa(a,function(a){return Xa(a,b,t,!0)}))):[]}function Xc(a,b){var c=-1,d=a?a.length:0,e={};for(!d||b||Ef(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Yc(a){return a=Ja(a),a.__chain__=!0,a}function Zc(a,b,c){return b.call(c,a)}function $c(a,b,c){var d=Ef(a)?Sa:hb;return c&&Cc(a,b,c)&&(b=null),("function"!=typeof b||c!==t)&&(b=rc(b,c,3)),d(a,b)}function _c(a,b,c){var d=Ef(a)?Va:jb;return b=rc(b,c,3),d(a,b)}function ad(a,b,c,d){var e=a?Se(a):0;return Fc(e)||(a=zd(a),e=a.length),e?(c="number"!=typeof c||d&&Cc(b,c,d)?0:0>c?we(e+c,0):c||0,"string"==typeof a||!Ef(a)&&sd(a)?e>c&&-1<a.indexOf(b,c):-1<tc(a,b,c)):!1}function bd(a,b,c){var d=Ef(a)?Wa:tb;return b=rc(b,c,3),d(a,b)}function cd(a,b,c){return(c?Cc(a,b,c):null==b)?(a=Kc(a),b=a.length,b>0?a[Ab(0,b-1)]:t):(a=dd(a),a.length=xe(0>b?0:+b||0,a.length),a)}function dd(a){a=Kc(a);for(var b=-1,c=a.length,d=Nd(c);++b<c;){var e=Ab(0,b);b!=e&&(d[b]=d[e]),d[e]=a[b]}return d}function ed(a,b,c){var d=Ef(a)?Ya:Db;return c&&Cc(a,b,c)&&(b=null),("function"!=typeof b||c!==t)&&(b=rc(b,c,3)),d(a,b)}function fd(a,b){var c;if("function"!=typeof b){if("function"!=typeof a)throw new Wd(L);var d=a;a=b,b=d}return function(){return 0<--a&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}}function gd(a,b,c){function d(){var c=b-(rf()-j);0>=c||c>b?(h&&ie(h),c=m,h=l=m=t,c&&(n=rf(),i=a.apply(k,g),l||h||(g=k=null))):l=ne(d,c)}function e(){l&&ie(l),h=l=m=t,(p||o!==b)&&(n=rf(),i=a.apply(k,g),l||h||(g=k=null))}function f(){if(g=arguments,j=rf(),k=this,m=p&&(l||!q),!1===o)var c=q&&!l;else{h||q||(n=j);var f=o-(j-n),r=0>=f||f>o;r?(h&&(h=ie(h)),n=j,i=a.apply(k,g)):h||(h=ne(e,f))}return r&&l?l=ie(l):l||b===o||(l=ne(d,b)),c&&(r=!0,i=a.apply(k,g)),!r||l||h||(g=k=null),i}var g,h,i,j,k,l,m,n=0,o=!1,p=!0;if("function"!=typeof a)throw new Wd(L);if(b=0>b?0:+b||0,!0===c)var q=!0,p=!1;else od(c)&&(q=c.leading,o="maxWait"in c&&we(+c.maxWait||0,b),p="trailing"in c?c.trailing:p);return f.cancel=function(){l&&ie(l),h&&ie(h),h=l=m=t},f}function hd(a,b){function c(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;return f.has(e)?f.get(e):(d=a.apply(this,d),c.cache=f.set(e,d),d)}if("function"!=typeof a||b&&"function"!=typeof b)throw new Wd(L);return c.cache=new hd.Cache,
c}function id(a,b){if("function"!=typeof a)throw new Wd(L);return b=we(b===t?a.length-1:+b||0,0),function(){for(var c=arguments,d=-1,e=we(c.length-b,0),f=Nd(e);++d<e;)f[d]=c[b+d];switch(b){case 0:return a.call(this,f);case 1:return a.call(this,c[0],f);case 2:return a.call(this,c[0],c[1],f)}for(e=Nd(b+1),d=-1;++d<b;)e[d]=c[d];return e[b]=f,a.apply(this,e)}}function jd(a,b){return a>b}function kd(a){return m(a)&&Ac(a)&&ce.call(a)==N}function ld(a){return!!a&&1===a.nodeType&&m(a)&&-1<ce.call(a).indexOf("Element")}function md(a,b,c,d){return d=(c="function"==typeof c?Nb(c,d,3):t)?c(a,b):t,d===t?rb(a,b,c):!!d}function nd(a){return m(a)&&"string"==typeof a.message&&ce.call(a)==R}function od(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function pd(a){return null==a?!1:ce.call(a)==S?ee.test(_d.call(a)):m(a)&&za.test(a)}function qd(a){return"number"==typeof a||m(a)&&ce.call(a)==T}function rd(a){return m(a)&&ce.call(a)==V}function sd(a){return"string"==typeof a||m(a)&&ce.call(a)==W}function td(a){return m(a)&&Fc(a.length)&&!!Ga[ce.call(a)]}function ud(a,b){return b>a}function vd(a){return cb(a,xd(a))}function wd(a){return pb(a,xd(a))}function xd(a){if(null==a)return[];od(a)||(a=Td(a));for(var b=a.length,b=b&&Fc(b)&&(Ef(a)||kd(a))&&b||0,c=a.constructor,d=-1,c="function"==typeof c&&c.prototype===a,e=Nd(b),f=b>0;++d<b;)e[d]=d+"";for(var g in a)f&&Bc(g,b)||"constructor"==g&&(c||!ae.call(a,g))||e.push(g);return e}function yd(a){a=Lc(a);for(var b=-1,c=Qf(a),d=c.length,e=Nd(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function zd(a){return Ib(a,Qf(a))}function Ad(a){return(a=e(a))&&a.replace(Aa,i).replace(ua,"")}function Bd(a){return(a=e(a))&&ta.test(a)?a.replace(sa,"\\$&"):a}function Cd(a,b,c){return c&&Cc(a,b,c)&&(b=0),Ae(a,b)}function Dd(a,b){var c="";if(a=e(a),b=+b,1>b||!a||!ue(b))return c;do b%2&&(c+=a),b=je(b/2),a+=a;while(b);return c}function Ed(a,b,c){var d=a;return(a=e(a))?(c?Cc(d,b,c):null==b)?a.slice(p(a),q(a)+1):(b+="",a.slice(f(a,b),g(a,b)+1)):a}function Fd(a,b,c){return c&&Cc(a,b,c)&&(b=null),a=e(a),a.match(b||Da)||[]}function Gd(a,b,c){return c&&Cc(a,b,c)&&(b=null),m(a)?Jd(a):db(a,b)}function Hd(a){return function(){return a}}function Id(a){return a}function Jd(a){return ub(eb(a,!0))}function Kd(a,b,c){if(null==c){var d=od(b),e=d?Qf(b):null;((e=e&&e.length?pb(b,e):null)?e.length:d)||(e=!1,c=b,b=a,a=this)}e||(e=pb(b,Qf(b)));var f=!0,d=-1,g=Gf(a),h=e.length;!1===c?f=!1:od(c)&&"chain"in c&&(f=c.chain);for(;++d<h;){c=e[d];var i=b[c];a[c]=i,g&&(a.prototype[c]=function(b){return function(){var c=this.__chain__;if(f||c){var d=a(this.__wrapped__);return(d.__actions__=Qa(this.__actions__)).push({func:b,args:arguments,thisArg:a}),d.__chain__=c,d}return c=[this.value()],le.apply(c,arguments),b.apply(a,c)}}(i))}return a}function Ld(){}function Md(a){return Dc(a)?xb(a):yb(a)}n=n?Ua.defaults(Ta.Object(),n,Ua.pick(Ta,Fa)):Ta;var Nd=n.Array,Od=n.Date,Pd=n.Error,Qd=n.Function,Rd=n.Math,Sd=n.Number,Td=n.Object,Ud=n.RegExp,Vd=n.String,Wd=n.TypeError,Xd=Nd.prototype,Yd=Td.prototype,Zd=Vd.prototype,$d=($d=n.window)?$d.document:null,_d=Qd.prototype.toString,ae=Yd.hasOwnProperty,be=0,ce=Yd.toString,de=n._,ee=Ud("^"+Bd(_d.call(ae)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fe=vc(n,"ArrayBuffer"),ge=vc(fe&&new fe(0),"slice"),he=Rd.ceil,ie=n.clearTimeout,je=Rd.floor,ke=vc(Td,"getPrototypeOf"),le=Xd.push,me=vc(n,"Set"),ne=n.setTimeout,oe=Xd.splice,pe=vc(n,"Uint8Array"),qe=vc(n,"WeakMap"),re=function(){try{var a=vc(n,"Float64Array"),b=new a(new fe(10),0,1)&&a}catch(c){}return b||null}(),se=vc(Td,"create"),te=vc(Nd,"isArray"),ue=n.isFinite,ve=vc(Td,"keys"),we=Rd.max,xe=Rd.min,ye=vc(Od,"now"),ze=vc(Sd,"isFinite"),Ae=n.parseInt,Be=Rd.random,Ce=Sd.POSITIVE_INFINITY,De=4294967294,Ee=2147483647,Fe=re?re.BYTES_PER_ELEMENT:0,Ge=9007199254740991,He=qe&&new qe,Ie={},Je=Ja.support={};!function(a){function b(){this.x=a}var c=[];b.prototype={valueOf:a,y:a};for(var d in new b)c.push(d);try{Je.dom=11===$d.createDocumentFragment().nodeType}catch(e){Je.dom=!1}}(1,0),Ja.templateSettings={escape:ma,evaluate:na,interpolate:oa,variable:"",imports:{_:Ja}};var Ke=function(){function a(){}return function(b){if(od(b)){a.prototype=b;var c=new a;a.prototype=null}return c||{}}}(),Le=Tb(nb),Me=Tb(ob,!0),Ne=Ub(),Oe=Ub(!0),Pe=He?function(a,b){return He.set(a,b),a}:Id;ge||(Ob=fe&&pe?function(a){var b=a.byteLength,c=re?je(b/Fe):0,d=c*Fe,e=new fe(b);if(c){var f=new re(e,0,c);f.set(new re(a,0,c))}return b!=d&&(f=new pe(e,d),f.set(new pe(a,d))),e}:Hd(null));var Qe=se&&me?function(a){return new Oa(a)}:Hd(null),Re=He?function(a){return He.get(a)}:Ld,Se=xb("length"),Te=function(){var a=0,b=0;return function(c,d){var e=rf(),f=H-(e-b);if(b=e,f>0){if(++a>=G)return c}else a=0;return Pe(c,d)}}(),Ue=id(function(a,b){return Ac(a)?gb(a,lb(b,!1,!0)):[]}),Ve=_b(),We=_b(!0),Xe=id(function(a){for(var b=a.length,d=b,e=Nd(k),f=tc(),g=f==c,h=[];d--;){var i=a[d]=Ac(i=a[d])?i:[];e[d]=g&&120<=i.length?Qe(d&&i):null}var g=a[0],j=-1,k=g?g.length:0,l=e[0];a:for(;++j<k;)if(i=g[j],0>(l?Pa(l,i):f(h,i,0))){for(d=b;--d;){var m=e[d];if(0>(m?Pa(m,i):f(a[d],i,0)))continue a}l&&l.push(i),h.push(i)}return h}),Ye=id(function(b,c){c=lb(c);var d=bb(b,c);return zb(b,c.sort(a)),d}),Ze=mc(),$e=mc(!0),_e=id(function(a){return Hb(lb(a,!1,!0))}),af=id(function(a,b){return Ac(a)?gb(a,b):[]}),bf=id(Vc),cf=id(function(a){var b=a.length,c=b>2?a[b-2]:t,d=b>1?a[b-1]:t;return b>2&&"function"==typeof c?b-=2:(c=b>1&&"function"==typeof d?(--b,d):t,d=t),a.length=b,Wc(a,c,d)}),df=id(function(a,b){return bb(a,lb(b))}),ef=Rb(function(a,b,c){ae.call(a,c)?++a[c]:a[c]=1}),ff=$b(Le),gf=$b(Me,!0),hf=cc(Ra,Le),jf=cc(function(a,b){for(var c=a.length;c--&&!1!==b(a[c],c,a););return a},Me),kf=Rb(function(a,b,c){ae.call(a,c)?a[c].push(b):a[c]=[b]}),lf=Rb(function(a,b,c){a[c]=b}),mf=id(function(a,b,c){var d=-1,e="function"==typeof b,f=Dc(b),g=Ac(a)?Nd(a.length):[];return Le(a,function(a){var h=e?b:f&&null!=a?a[b]:null;g[++d]=h?h.apply(a,c):zc(a,b,c)}),g}),nf=Rb(function(a,b,c){a[c?0:1].push(b)},function(){return[[],[]]}),of=ic(Xa,Le),pf=ic(function(a,b,c,d){var e=a.length;for(d&&e&&(c=a[--e]);e--;)c=b(c,a[e],e,a);return c},Me),qf=id(function(a,b){if(null==a)return[];var c=b[2];return c&&Cc(b[0],b[1],c)&&(b.length=1),Fb(a,lb(b),[])}),rf=ye||function(){return(new Od).getTime()},sf=id(function(a,b,c){var d=v;if(c.length)var e=o(c,sf.placeholder),d=d|A;return nc(a,d,b,c,e)}),tf=id(function(a,b){b=b.length?lb(b):wd(a);for(var c=-1,d=b.length;++c<d;){var e=b[c];a[e]=nc(a[e],v,a)}return a}),uf=id(function(a,b,c){var d=v|w;if(c.length)var e=o(c,uf.placeholder),d=d|A;return nc(b,d,a,c,e)}),vf=Yb(y),wf=Yb(z),xf=id(function(a,b){return fb(a,1,b)}),yf=id(function(a,b,c){return fb(a,b,c)}),zf=bc(),Af=bc(!0),Bf=hc(A),Cf=hc(B),Df=id(function(a,b){return nc(a,D,null,null,null,lb(b))}),Ef=te||function(a){return m(a)&&Fc(a.length)&&ce.call(a)==O};Je.dom||(ld=function(a){return!!a&&1===a.nodeType&&m(a)&&!Hf(a)});var Ff=ze||function(a){return"number"==typeof a&&ue(a)},Gf=d(/x/)||pe&&!d(pe)?function(a){return ce.call(a)==S}:d,Hf=ke?function(a){if(!a||ce.call(a)!=U)return!1;var b=vc(a,"valueOf"),c=b&&(c=ke(b))&&ke(c);return c?a==c||ke(a)==c:Ic(a)}:Ic,If=Sb(function(a,b,c){return c?_a(a,b,c):ab(a,b)}),Jf=id(function(a){var b=a[0];return null==b?b:(a.push(Za),If.apply(t,a))}),Kf=ac(nb),Lf=ac(ob),Mf=dc(Ne),Nf=dc(Oe),Of=ec(nb),Pf=ec(ob),Qf=ve?function(a){var b=null==a?null:a.constructor;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&Ac(a)?Jc(a):od(a)?ve(a):[]}:Jc,Rf=fc(!0),Sf=fc(),Tf=Sb(wb),Uf=id(function(a,b){if(null==a)return{};if("function"!=typeof b[0])return b=Wa(lb(b),Vd),Gc(a,gb(xd(a),b));var c=Nb(b[0],b[1],3);return Hc(a,function(a,b,d){return!c(a,b,d)})}),Vf=id(function(a,b){return null==a?{}:"function"==typeof b[0]?Hc(a,Nb(b[0],b[1],3)):Gc(a,lb(b))}),Wf=Wb(function(a,b,c){return b=b.toLowerCase(),a+(c?b.charAt(0).toUpperCase()+b.slice(1):b)}),Xf=Wb(function(a,b,c){return a+(c?"-":"")+b.toLowerCase()}),Yf=gc(),Zf=gc(!0);8!=Ae(Ea+"08")&&(Cd=function(a,b,c){return(c?Cc(a,b,c):null==b)?b=0:b&&(b=+b),a=Ed(a),Ae(a,b||(ya.test(a)?16:10))});var $f=Wb(function(a,b,c){return a+(c?"_":"")+b.toLowerCase()}),_f=Wb(function(a,b,c){return a+(c?" ":"")+(b.charAt(0).toUpperCase()+b.slice(1))}),ag=id(function(a,b){try{return a.apply(t,b)}catch(c){return nd(c)?c:new Pd(c)}}),bg=id(function(a,b){return function(c){return zc(c,a,b)}}),cg=id(function(a,b){return function(c){return zc(a,c,b)}}),dg=Zb(jd,-(1/0)),eg=Zb(ud,1/0);return Ja.prototype=Ka.prototype,La.prototype=Ke(Ka.prototype),La.prototype.constructor=La,Ma.prototype=Ke(Ka.prototype),Ma.prototype.constructor=Ma,Na.prototype["delete"]=function(a){return this.has(a)&&delete this.__data__[a]},Na.prototype.get=function(a){return"__proto__"==a?t:this.__data__[a]},Na.prototype.has=function(a){return"__proto__"!=a&&ae.call(this.__data__,a)},Na.prototype.set=function(a,b){return"__proto__"!=a&&(this.__data__[a]=b),this},Oa.prototype.push=function(a){var b=this.data;"string"==typeof a||od(a)?b.set.add(a):b.hash[a]=!0},hd.Cache=Na,Ja.after=function(a,b){if("function"!=typeof b){if("function"!=typeof a)throw new Wd(L);var c=a;a=b,b=c}return a=ue(a=+a)?a:0,function(){return 1>--a?b.apply(this,arguments):void 0}},Ja.ary=function(a,b,c){return c&&Cc(a,b,c)&&(b=null),b=a&&null==b?a.length:we(+b||0,0),nc(a,C,null,null,null,null,b)},Ja.assign=If,Ja.at=df,Ja.before=fd,Ja.bind=sf,Ja.bindAll=tf,Ja.bindKey=uf,Ja.callback=Gd,Ja.chain=Yc,Ja.chunk=function(a,b,c){b=(c?Cc(a,b,c):null==b)?1:we(+b||1,1),c=0;for(var d=a?a.length:0,e=-1,f=Nd(he(d/b));d>c;)f[++e]=Cb(a,c,c+=b);return f},Ja.compact=function(a){for(var b=-1,c=a?a.length:0,d=-1,e=[];++b<c;){var f=a[b];f&&(e[++d]=f)}return e},Ja.constant=Hd,Ja.countBy=ef,Ja.create=function(a,b,c){var d=Ke(a);return c&&Cc(a,b,c)&&(b=null),b?ab(d,b):d},Ja.curry=vf,Ja.curryRight=wf,Ja.debounce=gd,Ja.defaults=Jf,Ja.defer=xf,Ja.delay=yf,Ja.difference=Ue,Ja.drop=Oc,Ja.dropRight=Pc,Ja.dropRightWhile=function(a,b,c){return a&&a.length?Jb(a,rc(b,c,3),!0,!0):[]},Ja.dropWhile=function(a,b,c){return a&&a.length?Jb(a,rc(b,c,3),!0):[]},Ja.fill=function(a,b,c,d){var e=a?a.length:0;if(!e)return[];for(c&&"number"!=typeof c&&Cc(a,b,c)&&(c=0,d=e),e=a.length,c=null==c?0:+c||0,0>c&&(c=-c>e?0:e+c),d=d===t||d>e?e:+d||0,0>d&&(d+=e),e=c>d?0:d>>>0,c>>>=0;e>c;)a[c++]=b;return a},Ja.filter=_c,Ja.flatten=function(a,b,c){var d=a?a.length:0;return c&&Cc(a,b,c)&&(b=!1),d?lb(a,b):[]},Ja.flattenDeep=function(a){return a&&a.length?lb(a,!0):[]},Ja.flow=zf,Ja.flowRight=Af,Ja.forEach=hf,Ja.forEachRight=jf,Ja.forIn=Mf,Ja.forInRight=Nf,Ja.forOwn=Of,Ja.forOwnRight=Pf,Ja.functions=wd,Ja.groupBy=kf,Ja.indexBy=lf,Ja.initial=function(a){return Pc(a,1)},Ja.intersection=Xe,Ja.invert=function(a,b,c){c&&Cc(a,b,c)&&(b=null),c=-1;for(var d=Qf(a),e=d.length,f={};++c<e;){var g=d[c],h=a[g];b?ae.call(f,h)?f[h].push(g):f[h]=[g]:f[h]=g}return f},Ja.invoke=mf,Ja.keys=Qf,Ja.keysIn=xd,Ja.map=bd,Ja.mapKeys=Rf,Ja.mapValues=Sf,Ja.matches=Jd,Ja.matchesProperty=function(a,b){return vb(a,eb(b,!0))},Ja.memoize=hd,Ja.merge=Tf,Ja.method=bg,Ja.methodOf=cg,Ja.mixin=Kd,Ja.negate=function(a){if("function"!=typeof a)throw new Wd(L);return function(){return!a.apply(this,arguments)}},Ja.omit=Uf,Ja.once=function(a){return fd(2,a)},Ja.pairs=yd,Ja.partial=Bf,Ja.partialRight=Cf,Ja.partition=nf,Ja.pick=Vf,Ja.pluck=function(a,b){return bd(a,Md(b))},Ja.property=Md,Ja.propertyOf=function(a){return function(b){return qb(a,Mc(b),b+"")}},Ja.pull=function(){var a=arguments,b=a[0];if(!b||!b.length)return b;for(var c=0,d=tc(),e=a.length;++c<e;)for(var f=0,g=a[c];-1<(f=d(b,g,f));)oe.call(b,f,1);return b},Ja.pullAt=Ye,Ja.range=function(a,b,c){c&&Cc(a,b,c)&&(b=c=null),a=+a||0,c=null==c?1:+c||0,null==b?(b=a,a=0):b=+b||0;var d=-1;b=we(he((b-a)/(c||1)),0);for(var e=Nd(b);++d<b;)e[d]=a,a+=c;return e},Ja.rearg=Df,Ja.reject=function(a,b,c){var d=Ef(a)?Va:jb;return b=rc(b,c,3),d(a,function(a,c,d){return!b(a,c,d)})},Ja.remove=function(a,b,c){var d=[];if(!a||!a.length)return d;var e=-1,f=[],g=a.length;for(b=rc(b,c,3);++e<g;)c=a[e],b(c,e,a)&&(d.push(c),f.push(e));return zb(a,f),d},Ja.rest=Tc,Ja.restParam=id,Ja.set=function(a,b,c){if(null==a)return a;var d=b+"";b=null!=a[d]||Dc(b,a)?[d]:Mc(b);for(var d=-1,e=b.length,f=e-1,g=a;null!=g&&++d<e;){var h=b[d];od(g)&&(d==f?g[h]=c:null==g[h]&&(g[h]=Bc(b[d+1])?[]:{})),g=g[h]}return a},Ja.shuffle=dd,Ja.slice=function(a,b,c){var d=a?a.length:0;return d?(c&&"number"!=typeof c&&Cc(a,b,c)&&(b=0,c=d),Cb(a,b,c)):[]},Ja.sortBy=function(a,b,c){if(null==a)return[];c&&Cc(a,b,c)&&(b=null);var d=-1;return b=rc(b,c,3),a=tb(a,function(a,c,e){return{a:b(a,c,e),b:++d,c:a}}),Eb(a,h)},Ja.sortByAll=qf,Ja.sortByOrder=function(a,b,c,d){return null==a?[]:(d&&Cc(b,c,d)&&(c=null),Ef(b)||(b=null==b?[]:[b]),Ef(c)||(c=null==c?[]:[c]),Fb(a,b,c))},Ja.spread=function(a){if("function"!=typeof a)throw new Wd(L);return function(b){return a.apply(this,b)}},Ja.take=function(a,b,c){return a&&a.length?((c?Cc(a,b,c):null==b)&&(b=1),Cb(a,0,0>b?0:b)):[]},Ja.takeRight=function(a,b,c){var d=a?a.length:0;return d?((c?Cc(a,b,c):null==b)&&(b=1),b=d-(+b||0),Cb(a,0>b?0:b)):[]},Ja.takeRightWhile=function(a,b,c){return a&&a.length?Jb(a,rc(b,c,3),!1,!0):[]},Ja.takeWhile=function(a,b,c){return a&&a.length?Jb(a,rc(b,c,3)):[]},Ja.tap=function(a,b,c){return b.call(c,a),a},Ja.throttle=function(a,b,c){var d=!0,e=!0;if("function"!=typeof a)throw new Wd(L);return!1===c?d=!1:od(c)&&(d="leading"in c?!!c.leading:d,e="trailing"in c?!!c.trailing:e),Ia.leading=d,Ia.maxWait=+b,Ia.trailing=e,gd(a,b,Ia)},Ja.thru=Zc,Ja.times=function(a,b,c){if(a=je(a),1>a||!ue(a))return[];var d=-1,e=Nd(xe(a,4294967295));for(b=Nb(b,c,1);++d<a;)4294967295>d?e[d]=b(d):b(d);return e},Ja.toArray=function(a){var b=a?Se(a):0;return Fc(b)?b?Qa(a):[]:zd(a)},Ja.toPlainObject=vd,Ja.transform=function(a,b,c,d){var e=Ef(a)||td(a);return b=rc(b,d,4),null==c&&(e||od(a)?(d=a.constructor,c=e?Ef(a)?new d:[]:Ke(Gf(d)?d.prototype:null)):c={}),(e?Ra:nb)(a,function(a,d,e){return b(c,a,d,e)}),c},Ja.union=_e,Ja.uniq=Uc,Ja.unzip=Vc,Ja.unzipWith=Wc,Ja.values=zd,Ja.valuesIn=function(a){return Ib(a,xd(a))},Ja.where=function(a,b){return _c(a,ub(b))},Ja.without=af,Ja.wrap=function(a,b){return b=null==b?Id:b,nc(b,A,null,[a],[])},Ja.xor=function(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Ac(c))var d=d?gb(d,c).concat(gb(c,d)):c}return d?Hb(d):[]},Ja.zip=bf,Ja.zipObject=Xc,Ja.zipWith=cf,Ja.backflow=Af,Ja.collect=bd,Ja.compose=Af,Ja.each=hf,Ja.eachRight=jf,Ja.extend=If,Ja.iteratee=Gd,Ja.methods=wd,Ja.object=Xc,Ja.select=_c,Ja.tail=Tc,Ja.unique=Uc,Kd(Ja,Ja),Ja.add=function(a,b){return(+a||0)+(+b||0)},Ja.attempt=ag,Ja.camelCase=Wf,Ja.capitalize=function(a){return(a=e(a))&&a.charAt(0).toUpperCase()+a.slice(1)},Ja.clone=function(a,b,c,d){return b&&"boolean"!=typeof b&&Cc(a,b,c)?b=!1:"function"==typeof b&&(d=c,c=b,b=!1),"function"==typeof c?eb(a,b,Nb(c,d,1)):eb(a,b)},Ja.cloneDeep=function(a,b,c){return"function"==typeof b?eb(a,!0,Nb(b,c,1)):eb(a,!0)},Ja.deburr=Ad,Ja.endsWith=function(a,b,c){a=e(a),b+="";var d=a.length;return c=c===t?d:xe(0>c?0:+c||0,d),c-=b.length,c>=0&&a.indexOf(b,c)==c},Ja.escape=function(a){return(a=e(a))&&la.test(a)?a.replace(ja,j):a},Ja.escapeRegExp=Bd,Ja.every=$c,Ja.find=ff,Ja.findIndex=Ve,Ja.findKey=Kf,Ja.findLast=gf,Ja.findLastIndex=We,Ja.findLastKey=Lf,Ja.findWhere=function(a,b){return ff(a,ub(b))},Ja.first=Qc,Ja.get=function(a,b,c){return a=null==a?t:qb(a,Mc(b),b+""),a===t?c:a},Ja.gt=jd,Ja.gte=function(a,b){return a>=b},Ja.has=function(a,b){if(null==a)return!1;var c=ae.call(a,b);if(!c&&!Dc(b)){if(b=Mc(b),a=1==b.length?a:qb(a,Cb(b,0,-1)),null==a)return!1;b=Sc(b),c=ae.call(a,b)}return c||Fc(a.length)&&Bc(b,a.length)&&(Ef(a)||kd(a))},Ja.identity=Id,Ja.includes=ad,Ja.indexOf=Rc,Ja.inRange=function(a,b,c){return b=+b||0,"undefined"==typeof c?(c=b,b=0):c=+c||0,a>=xe(b,c)&&a<we(b,c)},Ja.isArguments=kd,Ja.isArray=Ef,Ja.isBoolean=function(a){return!0===a||!1===a||m(a)&&ce.call(a)==P},Ja.isDate=function(a){return m(a)&&ce.call(a)==Q},Ja.isElement=ld,Ja.isEmpty=function(a){return null==a?!0:Ac(a)&&(Ef(a)||sd(a)||kd(a)||m(a)&&Gf(a.splice))?!a.length:!Qf(a).length},Ja.isEqual=md,Ja.isError=nd,Ja.isFinite=Ff,Ja.isFunction=Gf,Ja.isMatch=function(a,b,c,d){return c="function"==typeof c?Nb(c,d,3):t,sb(a,uc(b),c)},Ja.isNaN=function(a){return qd(a)&&a!=+a},Ja.isNative=pd,Ja.isNull=function(a){return null===a},Ja.isNumber=qd,Ja.isObject=od,Ja.isPlainObject=Hf,Ja.isRegExp=rd,Ja.isString=sd,Ja.isTypedArray=td,Ja.isUndefined=function(a){return a===t},Ja.kebabCase=Xf,Ja.last=Sc,Ja.lastIndexOf=function(a,b,c){var d=a?a.length:0;if(!d)return-1;var e=d;if("number"==typeof c)e=(0>c?we(d+c,0):xe(c||0,d-1))+1;else if(c)return e=Lb(a,b,!0)-1,a=a[e],(b===b?b===a:a!==a)?e:-1;if(b!==b)return l(a,e,!0);for(;e--;)if(a[e]===b)return e;return-1},Ja.lt=ud,Ja.lte=function(a,b){return b>=a},Ja.max=dg,Ja.min=eg,Ja.noConflict=function(){return n._=de,this},Ja.noop=Ld,Ja.now=rf,Ja.pad=function(a,b,c){a=e(a),b=+b;var d=a.length;return b>d&&ue(b)?(d=(b-d)/2,b=je(d),d=he(d),c=kc("",d,c),c.slice(0,b)+a+c):a},Ja.padLeft=Yf,Ja.padRight=Zf,Ja.parseInt=Cd,Ja.random=function(a,b,c){c&&Cc(a,b,c)&&(b=c=null);var d=null==a,e=null==b;return null==c&&(e&&"boolean"==typeof a?(c=a,a=1):"boolean"==typeof b&&(c=b,e=!0)),d&&e&&(b=1,e=!1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1?(c=Be(),xe(a+c*(b-a+parseFloat("1e-"+((c+"").length-1))),b)):Ab(a,b)},Ja.reduce=of,Ja.reduceRight=pf,Ja.repeat=Dd,Ja.result=function(a,b,c){var d=null==a?t:a[b];return d===t&&(null==a||Dc(b,a)||(b=Mc(b),a=1==b.length?a:qb(a,Cb(b,0,-1)),d=null==a?t:a[Sc(b)]),d=d===t?c:d),Gf(d)?d.call(a):d},Ja.runInContext=s,Ja.size=function(a){var b=a?Se(a):0;return Fc(b)?b:Qf(a).length},Ja.snakeCase=$f,Ja.some=ed,Ja.sortedIndex=Ze,Ja.sortedLastIndex=$e,Ja.startCase=_f,Ja.startsWith=function(a,b,c){return a=e(a),c=null==c?0:xe(0>c?0:+c||0,a.length),a.lastIndexOf(b,c)==c},Ja.sum=function(a,b,c){c&&Cc(a,b,c)&&(b=null);var d=rc(),e=null==b;if(e&&d===db||(e=!1,b=d(b,c,3)),e){for(a=Ef(a)?a:Kc(a),b=a.length,c=0;b--;)c+=+a[b]||0;a=c}else a=Gb(a,b);return a},Ja.template=function(a,b,c){var d=Ja.templateSettings;c&&Cc(a,b,c)&&(b=c=null),a=e(a),b=_a(ab({},c||b),d,$a),c=_a(ab({},b.imports),d.imports,$a);var f,g,h=Qf(c),i=Ib(c,h),j=0;c=b.interpolate||Ba;var l="__p+='";c=Ud((b.escape||Ba).source+"|"+c.source+"|"+(c===oa?wa:Ba).source+"|"+(b.evaluate||Ba).source+"|$","g");var m="sourceURL"in b?"//# sourceURL="+b.sourceURL+"\n":"";if(a.replace(c,function(b,c,d,e,h,i){return d||(d=e),l+=a.slice(j,i).replace(Ca,k),c&&(f=!0,l+="'+__e("+c+")+'"),h&&(g=!0,l+="';"+h+";\n__p+='"),d&&(l+="'+((__t=("+d+"))==null?'':__t)+'"),j=i+b.length,b}),l+="';",(b=b.variable)||(l="with(obj){"+l+"}"),l=(g?l.replace(fa,""):l).replace(ga,"$1").replace(ha,"$1;"),l="function("+(b||"obj")+"){"+(b?"":"obj||(obj={});")+"var __t,__p=''"+(f?",__e=_.escape":"")+(g?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}",b=ag(function(){return Qd(h,m+"return "+l).apply(t,i)}),b.source=l,nd(b))throw b;return b},Ja.trim=Ed,Ja.trimLeft=function(a,b,c){var d=a;return(a=e(a))?a.slice((c?Cc(d,b,c):null==b)?p(a):f(a,b+"")):a},Ja.trimRight=function(a,b,c){var d=a;return(a=e(a))?(c?Cc(d,b,c):null==b)?a.slice(0,q(a)+1):a.slice(0,g(a,b+"")+1):a},Ja.trunc=function(a,b,c){c&&Cc(a,b,c)&&(b=null);var d=E;if(c=F,null!=b)if(od(b)){var f="separator"in b?b.separator:f,d="length"in b?+b.length||0:d;c="omission"in b?e(b.omission):c}else d=+b||0;if(a=e(a),d>=a.length)return a;if(d-=c.length,1>d)return c;if(b=a.slice(0,d),null==f)return b+c;if(rd(f)){if(a.slice(d).search(f)){var g,h=a.slice(0,d);for(f.global||(f=Ud(f.source,(xa.exec(f)||"")+"g")),f.lastIndex=0;a=f.exec(h);)g=a.index;b=b.slice(0,null==g?d:g)}}else a.indexOf(f,d)!=d&&(f=b.lastIndexOf(f),f>-1&&(b=b.slice(0,f)));return b+c},Ja.unescape=function(a){return(a=e(a))&&ka.test(a)?a.replace(ia,r):a},Ja.uniqueId=function(a){var b=++be;return e(a)+b},Ja.words=Fd,Ja.all=$c,Ja.any=ed,Ja.contains=ad,Ja.eq=md,Ja.detect=ff,Ja.foldl=of,Ja.foldr=pf,Ja.head=Qc,Ja.include=ad,Ja.inject=of,Kd(Ja,function(){var a={};return nb(Ja,function(b,c){Ja.prototype[c]||(a[c]=b)}),a}(),!1),Ja.sample=cd,Ja.prototype.sample=function(a){return this.__chain__||null!=a?this.thru(function(b){return cd(b,a)}):cd(this.value())},Ja.VERSION=u,Ra("bind bindKey curry curryRight partial partialRight".split(" "),function(a){Ja[a].placeholder=Ja}),Ra(["dropWhile","filter","map","takeWhile"],function(a,b){var c=b!=K,d=b==I;Ma.prototype[a]=function(a,e){var f=this.__filtered__,g=f&&d?new Ma(this):this.clone();return(g.__iteratees__||(g.__iteratees__=[])).push({done:!1,count:0,index:0,iteratee:rc(a,e,1),limit:-1,type:b}),g.__filtered__=f||c,g}}),Ra(["drop","take"],function(a,b){var c=a+"While";Ma.prototype[a]=function(c){var d=this.__filtered__,e=d&&!b?this.dropWhile():this.clone();return c=null==c?1:we(je(c)||0,0),d?b?e.__takeCount__=xe(e.__takeCount__,c):Sc(e.__iteratees__).limit=c:(e.__views__||(e.__views__=[])).push({size:c,type:a+(0>e.__dir__?"Right":"")}),e},Ma.prototype[a+"Right"]=function(b){return this.reverse()[a](b).reverse()},Ma.prototype[a+"RightWhile"]=function(a,b){return this.reverse()[c](a,b).reverse()}}),Ra(["first","last"],function(a,b){var c="take"+(b?"Right":"");Ma.prototype[a]=function(){return this[c](1).value()[0]}}),Ra(["initial","rest"],function(a,b){var c="drop"+(b?"":"Right");Ma.prototype[a]=function(){return this[c](1)}}),Ra(["pluck","where"],function(a,b){var c=b?"filter":"map",d=b?ub:Md;Ma.prototype[a]=function(a){return this[c](d(a))}}),Ma.prototype.compact=function(){return this.filter(Id)},Ma.prototype.reject=function(a,b){return a=rc(a,b,1),this.filter(function(b){return!a(b)})},Ma.prototype.slice=function(a,b){a=null==a?0:+a||0;var c=this;return 0>a?c=this.takeRight(-a):a&&(c=this.drop(a)),b!==t&&(b=+b||0,c=0>b?c.dropRight(-b):c.take(b-a)),c},Ma.prototype.toArray=function(){return this.drop(0)},nb(Ma.prototype,function(a,b){var c=Ja[b];if(c){var d=/^(?:filter|map|reject)|While$/.test(b),e=/^(?:first|last)$/.test(b);Ja.prototype[b]=function(){function b(a){return a=[a],le.apply(a,f),c.apply(Ja,a)}var f=arguments,g=this.__chain__,h=this.__wrapped__,i=!!this.__actions__.length,j=h instanceof Ma,k=f[0],l=j||Ef(h);return l&&d&&"function"==typeof k&&1!=k.length&&(j=l=!1),j=j&&!i,e&&!g?j?a.call(h):c.call(Ja,this.value()):l?(h=a.apply(j?h:new Ma(this),f),e||!i&&!h.__actions__||(h.__actions__||(h.__actions__=[])).push({func:Zc,args:[b],thisArg:Ja}),new La(h,g)):this.thru(b)}}}),Ra("concat join pop push replace shift sort splice split unshift".split(" "),function(a){var b=(/^(?:replace|split)$/.test(a)?Zd:Xd)[a],c=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",d=/^(?:join|pop|replace|shift)$/.test(a);Ja.prototype[a]=function(){var a=arguments;return d&&!this.__chain__?b.apply(this.value(),a):this[c](function(c){return b.apply(c,a)})}}),nb(Ma.prototype,function(a,b){var c=Ja[b];if(c){var d=c.name;(Ie[d]||(Ie[d]=[])).push({name:b,func:c})}}),Ie[jc(null,w).name]=[{name:"wrapper",func:null}],Ma.prototype.clone=function(){var a=this.__actions__,b=this.__iteratees__,c=this.__views__,d=new Ma(this.__wrapped__);return d.__actions__=a?Qa(a):null,d.__dir__=this.__dir__,d.__filtered__=this.__filtered__,d.__iteratees__=b?Qa(b):null,d.__takeCount__=this.__takeCount__,d.__views__=c?Qa(c):null,d},Ma.prototype.reverse=function(){if(this.__filtered__){var a=new Ma(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a},Ma.prototype.value=function(){var a=this.__wrapped__.value();if(!Ef(a))return Kb(a,this.__actions__);var b,c=this.__dir__,d=0>c;b=a.length;for(var e=this.__views__,f=0,g=-1,h=e?e.length:0;++g<h;){var i=e[g],j=i.size;switch(i.type){case"drop":f+=j;break;case"dropRight":b-=j;break;case"take":b=xe(b,f+j);break;case"takeRight":f=we(f,b-j)}}b={start:f,end:b},e=b.start,f=b.end,b=f-e,e=d?f:e-1,f=xe(b,this.__takeCount__),h=(g=this.__iteratees__)?g.length:0,i=0,j=[];a:for(;b--&&f>i;){for(var e=e+c,k=-1,l=a[e];++k<h;){var m=g[k],n=m.iteratee,o=m.type;if(o==I){if(m.done&&(d?e>m.index:e<m.index)&&(m.count=0,m.done=!1),m.index=e,!(m.done||(o=m.limit,m.done=o>-1?m.count++>=o:!n(l))))continue a}else if(m=n(l),o==K)l=m;else if(!m){if(o==J)continue a;break a}}j[i++]=l}return j},Ja.prototype.chain=function(){return Yc(this)},Ja.prototype.commit=function(){return new La(this.value(),this.__chain__)},Ja.prototype.plant=function(a){for(var b,c=this;c instanceof Ka;){var d=Nc(c);b?e.__wrapped__=d:b=d;var e=d,c=c.__wrapped__}return e.__wrapped__=a,b},Ja.prototype.reverse=function(){var a=this.__wrapped__;return a instanceof Ma?(this.__actions__.length&&(a=new Ma(this)),new La(a.reverse(),this.__chain__)):this.thru(function(a){return a.reverse()})},Ja.prototype.toString=function(){return this.value()+""},Ja.prototype.run=Ja.prototype.toJSON=Ja.prototype.valueOf=Ja.prototype.value=function(){return Kb(this.__wrapped__,this.__actions__)},Ja.prototype.collect=Ja.prototype.map,Ja.prototype.head=Ja.prototype.first,Ja.prototype.select=Ja.prototype.filter,Ja.prototype.tail=Ja.prototype.rest,Ja}var t,u="3.9.0",v=1,w=2,x=4,y=8,z=16,A=32,B=64,C=128,D=256,E=30,F="...",G=150,H=16,I=0,J=1,K=2,L="Expected a function",M="__lodash_placeholder__",N="[object Arguments]",O="[object Array]",P="[object Boolean]",Q="[object Date]",R="[object Error]",S="[object Function]",T="[object Number]",U="[object Object]",V="[object RegExp]",W="[object String]",X="[object ArrayBuffer]",Y="[object Float32Array]",Z="[object Float64Array]",$="[object Int8Array]",_="[object Int16Array]",aa="[object Int32Array]",ba="[object Uint8Array]",ca="[object Uint8ClampedArray]",da="[object Uint16Array]",ea="[object Uint32Array]",fa=/\b__p\+='';/g,ga=/\b(__p\+=)''\+/g,ha=/(__e\(.*?\)|\b__t\))\+'';/g,ia=/&(?:amp|lt|gt|quot|#39|#96);/g,ja=/[&<>"'`]/g,ka=RegExp(ia.source),la=RegExp(ja.source),ma=/<%-([\s\S]+?)%>/g,na=/<%([\s\S]+?)%>/g,oa=/<%=([\s\S]+?)%>/g,pa=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,qa=/^\w*$/,ra=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,sa=/[.*+?^${}()|[\]\/\\]/g,ta=RegExp(sa.source),ua=/[\u0300-\u036f\ufe20-\ufe23]/g,va=/\\(\\)?/g,wa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,xa=/\w*$/,ya=/^0[xX]/,za=/^\[object .+?Constructor\]$/,Aa=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ba=/($^)/,Ca=/['\n\r\u2028\u2029\\]/g,Da=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),Ea=" 	\f\ufeff\n\r\u2028\u2029",Fa="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout document isFinite parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap window".split(" "),Ga={};Ga[Y]=Ga[Z]=Ga[$]=Ga[_]=Ga[aa]=Ga[ba]=Ga[ca]=Ga[da]=Ga[ea]=!0,Ga[N]=Ga[O]=Ga[X]=Ga[P]=Ga[Q]=Ga[R]=Ga[S]=Ga["[object Map]"]=Ga[T]=Ga[U]=Ga[V]=Ga["[object Set]"]=Ga[W]=Ga["[object WeakMap]"]=!1;var Ha={};Ha[N]=Ha[O]=Ha[X]=Ha[P]=Ha[Q]=Ha[Y]=Ha[Z]=Ha[$]=Ha[_]=Ha[aa]=Ha[T]=Ha[U]=Ha[V]=Ha[W]=Ha[ba]=Ha[ca]=Ha[da]=Ha[ea]=!0,Ha[R]=Ha[S]=Ha["[object Map]"]=Ha["[object Set]"]=Ha["[object WeakMap]"]=!1;var Ia={leading:!1,maxWait:0,trailing:!1},Ja={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"},Ka={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},La={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Ma={"function":!0,object:!0},Na={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Oa=Ma[typeof exports]&&exports&&!exports.nodeType&&exports,Pa=Ma[typeof module]&&module&&!module.nodeType&&module,Qa=Ma[typeof self]&&self&&self.Object&&self,Ra=Ma[typeof window]&&window&&window.Object&&window,Sa=Pa&&Pa.exports===Oa&&Oa,Ta=Oa&&Pa&&"object"==typeof global&&global&&global.Object&&global||Ra!==(this&&this.window)&&Ra||Qa||this,Ua=s();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Ta._=Ua,define(function(){return Ua})):Oa&&Pa?Sa?(Pa.exports=Ua)._=Ua:Oa._=Ua:Ta._=Ua}.call(this),_}),angular.module("lumiataFoosballApp").directive("tablePlayerSlot",["Players",function(a){return{templateUrl:"/views/tablePlayerSlot.html",restrict:"E",scope:{slot:"=",raised:"="},link:function(b){b.players=!1,b.updateGame=function(){b.$parent.$parent.updateGame()},a.query(function(a){b.players=a},function(a){console.log("cannot get players",a)})}}}]),angular.module("lumiataFoosballApp").service("Games",["$resource","$window","lodash","amMoment",function(a,b,c,d){function e(a){return a?(a.date?a.time=d.preprocessDate(a.date).toDate():a.time=null,a):null}function f(a){return a?function(a){var b=JSON.parse(a);return c.map(b,e)}:function(a){var b=JSON.parse(a);return e(b)}}var g="/games";return/lumiata-foosball.com/.test(b.location.host)&&(g="http://lumiata-foosball.com:5000"+g),a(g,{id:"@id"},{get:{method:"GET",url:g+"/:id",transformResponse:f()},query:{method:"GET",isArray:!0,transformResponse:f(!0)},destroy:{method:"DELETE",url:g+"/all"},add:{method:"POST"},latest:{method:"GET",url:g+"/latest",transformResponse:f()},screwWithTime:{method:"POST",url:g+"/screwWithTime",transformResponse:f()}})}]),angular.module("lumiataFoosballApp").controller("HistoryCtrl",["$scope","Games","$mdDialog",function(a,b,c){b.query(function(b){a.games=b}),a.destroyGames=function(){c.show(c.confirm().parent(angular.element(document.body)).title("Duplicate Record").content("Remove ALL the games?").ok("Cleanse the games").cancel("God no!")).then(function(){b.destroy(function(){b.query(function(b){a.games=b})})})}}]),angular.module("lumiataFoosballApp").directive("avatarUpload",function(){return{templateUrl:"/views/avatarUpload.html",restrict:"E",link:function(a,b){a["interface"]={},b.find(".avatar-file").on("change",function(){try{var c=this.files[0];if(c){var d=new FileReader(c);d.onload=function(c){b.find(".avatar-file-data").val(c.target.result),a.avatar=c.target.result},d.readAsBinaryString(c)}}catch(e){console.log("can't read file data; must be bad api",e)}});var c=0;a.$watch("newPlayer",function(a){a&&a.id!==c&&(b.find(".avatar.file").val(""),b.find(".avatar-file-upload").val(),c=a.id)}),a.$on("$dropletReady",function(){a["interface"].allowedExtensions(["png","jpg","bmp","gif"])})}}}),angular.module("lumiataFoosballApp").controller("PlayerticketCtrl",["$scope","Players","$routeParams","lodash",function(a,b,c,d){b.get({id:c.id},function(b){a.player=b,a.playerid=c.id,console.log("playerid in PTC: ",c.id),d.each(b.games,function(a){a.time=new Date(a.date)})})}]),angular.module("lumiataFoosballApp").controller("TournamentCtrl",["$scope","Players","lodash","Games","$mdDialog","$mdToast",function(a,b,c,d,e,f){function g(b,e){function f(a){var d=c.reduce(a,function(a,d){var e=c.find(b,"name",d);return e&&a.push(e.rank),a},[]);d=c.sortBy(d,c.identity).reverse();var e=d.shift();return d.length&&(e+=Math.sqrt(d[0])),e}function g(){return l.length<j}function h(){return m.length<k}for(var i=c(b).pluck("name").shuffle().value(),j=Math.floor(3*Math.random())+1,k=Math.floor(Math.random()*Math.random()*3)+1,l=[i.pop()],m=[i.pop()];(g()||h())&&i.length;)g()&&h()?Math.random()>.5?l.push(i.pop()):m.push(i.pop()):g()?l.push(i.pop()):h()&&m.push(i.pop());var n,o=f(l),p=f(m),q=o/(o+p);n=Math.random()>q?1:2;var r=new Date(a.startDate),s=e?e.time:r;s.getTime()>r.getTime()&&(r=s);var t,u=r.getTime(),v=new Date(a.endDate);if(v.getTime()<u)v.setTime(v.getTime()+1e5*Math.random()),t=v;else{var w=v.getTime(),x=Math.min(u,w);w=Math.max(u,w),u=x;var y=w-u;t=new Date(Math.floor(Math.random()*Math.random()*y+u));
}var z={team1:l,team2:m,winner:n,date:t.toISOString()};d.add(z,function(b,c){a.games.push(c||z)})}a.games=50,a.startDate=new Date,a.endDate=new Date,a.games=[],a.gameCount=50,a.screwWithTime=function(){e.show(e.confirm().parent(angular.element(document.body)).title("Alter the Space Time Continuum").content("Do you want to shift any games made with tournament (and any other games) into the past?").ok("That's why I have a TARDIS").cancel("I perfer my current reality")).then(function(){d.screwWithTime(function(){f.simple().content("All games have been shifted into the past!").position("top right").hideDelay(3e3)})})},a.createGames=function(){function c(){b.query(function(a){d.latest(function(b){g(a,b),--e,e>0&&c()},function(b){"no games"===b.data.error&&(g(a),--e,e>0&&c())})})}var e=a.gameCount;c()}}]),angular.module("lumiataFoosballApp").directive("playerGraph",["Players","lodash",function(a,b){return{template:"<div></div>",restrict:"E",scope:{playerid:"=",width:"=",height:"="},link:function(c,d){c.element=d,c.$watch("playerid",function(e){e&&a.get({id:e},function(a){var e=Raphael,f=e(d[0],c.width,c.height),g=f.rect(0,0,c.width,c.height);if(g.attr("fill","black"),g.attr("stroke","grey"),a.games.length){var h=b.reduce(a.games,function(a,b){return Math.max(a,b.newRank)},0);h=100*Math.ceil(h/100);var i=c.height/h,j=b.reduce(a.games,function(b,d,e){var f=Math.round(e*c.width/a.games.length),g=Math.round((h-d.newRank)*i);return b+"L"+f+","+g},"M0,"+Math.round((h-1200)*i)),k=f.path(j);k.attr({stroke:"white"}),k.attr({"stroke-width":4})}})})}}}]),angular.module("lumiataFoosballApp").directive("gamesList",["lodash",function(a){return{templateUrl:"/views/gameList.html",restrict:"E",scope:{games:"="},controller:["$scope",function(b){function c(b,c){var d=b["team"+c];return a.uniq(a.difference(d,["(none)"]))}b.winners=function(a){return c(a,a.winner)},b.losers=function(a){return 1===a.winner?c(a,2):c(a,1)}}]}}]),angular.module("lumiataFoosballApp").directive("playersGraph",["Players","lodash","amMoment",function(a,b,c){function d(a,b,c){var d=c-b;return a-=b,a*=255/d,Math.floor(a)}function e(a){return b(a.games).reduce(function(a,b){return Math.max(a,b.oldRank,b.newRank)},0)}function f(a){return b(a.games).reduce(function(a,b){return Math.min(a,b.oldRank,b.newRank)},2e3)}function g(a){var b=a.charCodeAt(0)%255,c=a.charCodeAt(a.length-1)%255,e=a.charCodeAt(Math.round(a.length/2))%255,f=Math.min(b,c,e),g=Math.max(b,c,e);b=d(b,f,g),c=d(c,f,g),e=d(e,f,g);var i={r:b,g:c,b:e};return h(i)}var h=b.template("rgb(<%= r %>,<%= g %>, <%= b %>)"),i=.25,j=800,k=250,l=2,m=6;return{templateUrl:"/views/playersGraph.html",restrict:"E",scope:{width:"=",height:"=",sizer:"="},link:function(d,h){function n(){r={},s=null,t={}}function o(a){r[a]&&(r[a].animate({"stroke-opacity":i,"stroke-width":l},j,"<>",function(){"fading in"===t[a]&&(t[a]="hidden")}),t[a]="fading out")}function p(){d.width&&d.height&&a.query(function(a){function j(a){return Math.round(d.height-(a-x)*z)}d.players=a,b.each(a,function(a){a.color=a.games.length?g(a.name):"rgb(150, 150, 150)"});var k=b(a).map(function(a){return b(a.games).pluck("date").value()}).flatten().map(function(a){return c.preprocessDate(a).toDate()}).value(),m=b(k).map(function(a){return a.getTime()}),o=m.reduce(function(a,c){return b.isNull(a)?c:Math.min(a,c)}),p=m.reduce(function(a,c){return b.isNull(a)?c:Math.max(a,c)});d.startDate=new Date(o),d.endDate=new Date(p);var s=p-o,t=d.width/s;n(),q&&q.clear(),h.find(".graph-frame__graph").empty();var u=Raphael;q=u(h.find(".graph-frame__graph")[0],d.width,d.height);var v=q.rect(0,0,d.width,d.height);v.attr("fill","black"),v.attr("stroke","grey");var w=b(a).reduce(function(a,b){return Math.max(a,e(b))},0),x=b(a).reduce(function(a,b){return Math.min(a,f(b))},2e3);w=100*Math.ceil(w/100),x=100*Math.floor(x/100);var y=w-x,z=d.height/y,A="M0,"+j(1200)+"L"+d.width+","+j(1200),B=q.path(A),C=q.rect(0,j(1200),d.width,d.height-j(1200));C.attr({fill:"rgba(250, 250,255, 0.125)"}),B.attr({stroke:"rgb(255,0,0)","stroke-width":1,"stroke-linecap":"round"}),b.each(a,function(a){if(!(a.games.length<1)){var d=b.reduce(a.games,function(a,b){var d=c.preprocessDate(b.date).toDate().getTime(),e=d-o,f=Math.round(e*t),g=j(b.oldRank),h=j(b.newRank);return a+"L"+f+","+g+"L"+f+","+h},"M0,"+Math.round((w-1200)*z)),e=q.path(d);e.attr({stroke:a.color,"stroke-width":l,"stroke-opacity":i}),r[a.name]=e}})})}d.element=h;var q,r={},s=null,t={};n(),d.hover=function(a,b){if(b)o(a.name),s.name===a.name&&(s=null);else{if(s&&s.name!==a.name&&o(s.name),!a.games.length||!r[a.name])return;s=a,t[a.name]="fading in",r[a.name].animate({"stroke-opacity":1,"stroke-width":m},k,"<>",function(){"fading in"===t[a.name]&&(t[a.name]="live")})}},p();var u=b.debounce(p,1e3);d.$watch("sizer",function(a){a&&a.on("resize",u)})}}}]),angular.module("lumiataFoosballApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/avatarUpload.html",'<!-- droplet style="border: 2px dotted blue;  padding: 2rem; display: block" ng-model="interface" ng-model="newPlayer.avatarDroplet" --> <input type="file" name="avatar-file" class="avatar-file" ng-model="player.avatarData"> <input type="hidden" class="avatar-file-data" ng-model="player.avatarFileData" name="avatarFileData"> <!--Drag Files Here --><!--/droplet -->\''),a.put("views/foosballTable.html",'<div class="foosball-frame" style="height: 100%" layout="row" layout-fill layout-align="center center" hide-sm hide-md> <div class="foosball-table" layout="column"> <div class="player-row team-1 {{winClass1}}" flex="20" layout="row" layout-align="start center" layout-padding> <div class="team-select" flex> <md-button class="md-fab md-primary md-hue-2" aria-label="Team 1" ng-click="selectTeam(1)"> <md-icon md-svg-src="/images/choose-arrow.5b0bc3de.svg"></md-icon> </md-button> </div> <table-player-slot raised="true" ng-repeat="slot in topSlots" slot="slot" flex="25"> </table-player-slot> </div> <div flex class="field" layout layout-align="center center"> <div class="winner" ng-if="winningTeamNumber && saveable" flex="80"> Winner: Team {{winningTeamNumber}}! <div> <md-button class="md-raised md-primary" ng-click="saveGame()">Save Game</md-button> </div> </div> <div class="error" ng-if="winningTeamNumber && (!saveable)"> <p layout layout-align="center center"> <span>Make sure both teams have at least one player and each player is used only once.</span></p> </div> <div class="instructions" ng-if="!winningTeamNumber"> <p layout="column" layout-fill layout-align="center center"> <span>Set the names of the people on each side</span> <span ng-if="!winningTeamNumber">then click one of the two circular buttons to choose the winning team.</span> </p> </div> </div> <div class="player-row team-2 {{winClass2}}" flex="20" layout="row" layout-align="start center" layout-padding> <div class="team-select" flex> <md-button class="md-fab md-primary md-hue-2" aria-label="Team 2" ng-click="selectTeam(2)"> <md-icon md-svg-src="/images/choose-arrow.5b0bc3de.svg"></md-icon> </md-button> </div> <table-player-slot raised="true" ng-repeat="slot in bottomSlots" slot="slot" flex="25"> </table-player-slot> </div> </div> </div> <md-content layout="column" layout-fill hide-gt-md class="team-1 team-small {{winClass1}}"> <md-toolbar> <div class="md-toolbar-tools"> <md-button class="md-fab md-primary md-hue-2" aria-label="Team 1" ng-click="selectTeam(1)"> <md-icon md-svg-src="/images/choose-arrow.5b0bc3de.svg"></md-icon> </md-button> <h2> <span>Team 1</span> </h2> <span flex></span> </div> </md-toolbar> <md-list> <md-subheader class=""> <span ng-if="!winningTeamNumber">Click one of the arrow buttons to indicate which team won</span> <span class="error" ng-if="winningTeamNumber && (!saveable)">Make sure both teams have at least one player and each player is used only once.</span> </md-subheader> <md-list-item ng-repeat="slot in topSlots" ng-class="{duplicate: slot.duplicate}"> <table-player-slot slot="slot"></table-player-slot> </md-list-item> </md-list> </md-content> <md-content layout="column" layout-fill hide-gt-md class="team-2 team-small {{winClass2}}"> <md-toolbar> <div class="md-toolbar-tools"> <md-button class="md-fab md-primary md-hue-2" aria-label="Team 2" ng-click="selectTeam(2)"> <md-icon md-svg-src="/images/choose-arrow.5b0bc3de.svg"></md-icon> </md-button> <h2> <span>Team 2</span> </h2> <span flex></span> </div> </md-toolbar> <md-list> <md-list-item ng-repeat="slot in bottomSlots" ng-class="{duplicate: slot.duplicate}"> <table-player-slot slot="slot"></table-player-slot> </md-list-item> <md-list-item ng-if="winningTeamNumber && saveable" layout="row" layout-fill> <div flex></div> <md-button class="md-raised md-primary" flex="50" style="max-width: 10rem" ng-click="saveGame()">Save Game </md-button> </md-list-item> </md-list> </md-content>'),a.put("views/game.html",'<h1 hide-sm hide-md class="md-display-3" layout layout-align="center center"><span> Record Game Result</span></h1> <h1 hide-gt-md class="md-display-1" layout layout-align="center center"><span> Record Game Result</span></h1> <foosball-table> </foosball-table>'),a.put("views/gameList.html",'<md-content> <md-list> <md-list-item ng-repeat="game in games | orderBy: \'time\': true" hide-sm hide-md> <div layout="row" layout-fill style="max-width: 60rem"> <div flex> {{ game.time | date:\'medium\' }} ({{ game.time |timeAgo }}) </div> <div flex="30"> <b>Winners:</b> <div> <span ng-repeat="winner in winners(game) track by $index">{{ winner}}<span ng-if="!$last">, </span></span> </div> </div> <div flex="30"> <b>Losers:</b> <div> <span ng-repeat="loser in losers(game) track by $index">{{ loser}}<span ng-if="!$last">, </span></span> </div> </div> </div> <md-divider ng-if="!$last"></md-divider> </md-list-item> </md-list> <md-list-item ng-repeat="game in games | orderBy: \'time\': true" hide-gt-md class="md-3-line"> <div class="md-list-item-text"> <h3> {{ game.date| date:\'short\' }} ({{ game.time |timeAgo }})</h3> <h4><b>Winners:</b> <span ng-repeat="winner in winners(game) track by $index">{{ winner}}<span ng-if="!$last">, </span></span> </h4> <p><b>Losers:</b> <span ng-repeat="loser in losers(game) track by $index">{{ loser}}<span ng-if="!$last">, </span></span> </p> </div> <md-divider ng-if="!$last"></md-divider> </md-list-item>  </md-content>'),a.put("views/history.html",'<h1 hide-sm hide-md class="md-display-3" layout layout-align="center center"><span> Game History</span></h1> <h1 hide-gt-md class="md-display-1" layout layout-align="center center"><span> Game History</span></h1> <games-list games="games"></games-list> <md-card ng-if="games.length"> <md-card-content layout="row" layout-sm="column"> <div flex>Delete ALL history and reset all players\' ranks to 1200:</div> <div flex="33"> <md-button class="md-primary md-raised md-warn" ng-click="destroyGames()">DELETE ALL GAMES</md-button> </div> </md-card-content> </md-card>'),a.put("views/main.html",'<h1 hide-sm hide-md class="md-display-3" layout layout-align="center center"><span> Lumiata Foosball Game Recorder</span></h1> <h1 hide-gt-md class="md-display-1" layout layout-align="center center"><span> Lumiata Foosball Game Recorder</span></h1> <div layout layout-align="center center"> <players-graph width="width" height="height" sizer="sizer"></players-graph> </div> <md-content layout-padding class="md-raised"> <h2 class="md-display-3">Welcome to Lumiata Foosball</h2> <p>This site has the ability to record individual games as well as the ability to spawn mulitple games as a simulation, under Tournament. </p> <p>The site has buttons for deleting players and games en masse; plese don\'t.</p> <p>You can add players individually or in a comma seperated list hidden under a tab in players.</p> <h3 class="md-display-3">Generated or entered data</h3> <p>This site can be used in one of two ways:</p> <ol> <li>Entering in games and players one by one as they are played.</li> <li>Blasting a mess of simulated data into the repo using the Tournament page.</li> </ol> <p>The latter system will create records from the most recently entered game to some point (manually set) in the future. Mixing future-projected games with manually entered games can create a mess as explained in the tournament page.</p> <p>Also a system that can work equally well in both cases, you can enter in several player names at once using a text field accessible through a tab in the players field. You can do this with real players, or with simulated players.</p> <h3 class="md-display-2">ELO resolution</h3> <p>The game currently promotes or lowers everyone on the team as if they had beaten (or been beaten by) the best player on the opposing team. </p> <h3 class="md-display-2">Data Modelling</h3> <p>Because the games span multiple players (and for validation/archival purposes, and graphing) the history of a player\'s rank progress as affected by each game is kept in an array in the players\' records. the player\'s schema is:</p> <pre>\nvar schema = new mongoose.Schema({\n  name: {type: \'string\', index: {unique: true}},\n  rank: {type: \'number\', default: 1200},\n  avatar: {type: \'buffer\'},\n  games: [\n    {\n      game: mongoose.Schema.Types.ObjectId,\n      oldRank: \'number\',\n      newRank: \'number\',\n      date: {type: Date, default: Date.now},\n      won: \'boolean\'\n    }\n  ]\n});\n  </pre> <p>additionally, games are recorded using the players\' name (though honestly it would have been better to use IDs): </p> <pre>\nvar schema = new mongoose.Schema({\n  date: {type: Date, default: Date.now},\n  team1: [\'string\'],\n  team2: [\'string\'],\n  players: [\'string\'],\n  winner: \'number\'\n});\n  </pre> <p>witht the teams and players being the names of the players. players is the sum of team1 and team2, used as a lookup index. Winner is 1 or 2.</p> <p>there is incomplete work on player avatars; they can be uploaded and stored but are not present in the UI,</p> <h3 class="md-display-2">Local Installation</h3> <p>This site is actually a hybrid of two repositories. One is an Angular-generator based engine for static Angular generation. The other site is a node proxy for MongoLabs. </p> <p>To get the sites to load and view properly you must put your etc.hosts file to read localhost as <code>http://lumiata-foosball.com/</code> and load that url in the browser.</p> <p>The node site must be loaded to proxy for MongoLabs. </p> <p>In production (on Heroku) the angular site is published and copied into the Nodes\' static directories which on heroku use the local express endpoints as rest gateways to MongoLabs.</p> <p>The Express site does extensive business logic behind updating games and players, via Mongoose instance methods. </p> <h4 class="md-headline">The Angular Generated Site</h4> <p>The Angular code is a product of the angular generator; it is on github at <a href="https://github.com/bingomanatee/lumiata-foosball" target="_blank">https://github.com/bingomanatee/lumiata-foosball</a>. To run it you will need:</p> <ol> <li>Yeoman</li> <li> Node</li> <li>Bower</li> <li>Compass</li> <li>SASS</li> <li>Grunt</li> </ol> <p>You will NOT need mongo because it uses MongoLabs as a remove service -- though you WILL need the node server (see below).</p> <p>Once installed, you can use the <code>grunt serve</code> command line to run it locally. However it will try to serve it through the localhost url and in that situation it won\'t be able to connect to mongolabs. To run it locally you must remap <code>http://lumiata-foosball.com</code> in <code>/etc/hosts</code> to localhost.</p> <p>Also, before running the angular site the node site must be initialized and run locally. </p> <h4 class="md-headline">The Node Site</h4> <p>The node site is hosted on heroku and can be run locally. In fact you can run the node site and get the full experience without hosting the angular site. Its code is on github at <a href="https://github.com/bingomanatee/lumiata-foosball-server" target="_blank">https://github.com/bingomanatee/lumiata-foosball-server</a> </p> <p>To run the node site you will only need node installed locally, and to do the usuall <code>npm install</code> inside its source directory. The angular dev site needs node to run but the node side is not dependant on tha angular side. The node site is executable through <code>node index.js</code> in its root.</p> <p>The node site contains a compressed build of the angular site in its public folder. There is no magic sync to that - its manual -- so it might get out of date.</p> <p>It is pushed to Heroku. You can run the site purely off a local install of the node site (which is good because it has fewer technical prereqs) but the serverside code will be obfuscated and harder to trace through. </p> <h4 class="md-headline">Tests</h4> <p>The Angular site has no useful tests. The node site has model tests; for it to work you must have mongo up and running and a <code>lumiata-test</code> database.</p> <p> the tests are mocha and you must have mocha and expect.js installed globally; then type <code>mocha tests/</code> in the node root.</p> </md-content>'),a.put("views/players.html",'<h1 hide-sm hide-md class="md-display-3" layout layout-align="center center"><span> Players</span></h1> <h1 hide-gt-md class="md-display-1" layout layout-align="center center"><span> Players</span></h1> <md-tabs md-dynamic-height md-border-bottom md-selected="0"> <md-tab label="Add a single player"> <md-card class="new-player-form"> <md-toolbar> <h3 layout layout-align="center center" class="md-headline"><span>Add a player to the registry</span></h3> </md-toolbar> <md-card-content> <form name="newPlayerForm" enctype="multipart/form-data"> <div layout layout-sm="column" layout-padding layout-fill> <md-input-container flex style="max-width: 30rem"> <label>Name</label> <input ng-model="newPlayer.name" required> </md-input-container> <div flex="40"> <div>Avatar (optional)</div> <avatar-upload></avatar-upload> </div> </div> </form> <p>note- you can tab over to add multiple players at once, above.</p> </md-card-content> <div class="md-actions" layout="row" layout-padding layout-align="end center"> <md-button class="md-raised md-primary" ng-click="addPlayer()"> Create Player </md-button> </div> </md-card> </md-tab> <md-tab label="Add several players"> <form name="multiPlayerForm"> <md-toolbar> <h3 layout layout-align="center center" class="md-headline"><span>Add mulitple players</span></h3> </md-toolbar> <md-card-content> <p>Add multiple characters, seperated by commas or new lines</p> <md-input-container flex> <label>Characters</label> <textarea ng-model="$parent.playersText" rows="5" columns="1" ng-change="$parent.updatePlayersText()"></textarea> </md-input-container> <div> <md-chips ng-if="multiPlayers" ng-model="multiPlayers" readonly></md-chips> </div> </md-card-content> <div class="md-actions" layout="row" layout-padding layout-align="end center"> <md-button class="md-raised md-primary" ng-click="addPlayers()"> Create Players </md-button> </div> </form> </md-tab> </md-tabs> <md-list ng-if="players.length"> <md-subheader class="md-no-sticky">Players</md-subheader> <md-list-item ng-repeat="player in players"> <p layout="row" layout-padding> <span flex style="min-width:10rem"> {{ player.name }} ({{ player.rank }}) -- {{player.games.length }} games </span> <span style="width: 10rem"> <md-button class="md-raised" href="#/players/{{ player._id}}">Detail</md-button> </span> </p> </md-list-item> </md-list> <md-card ng-if="players.length"> <md-card-content layout="row" layout-sm="column"> <div flex>Delete ALL PLAYERS and GAMES:</div> <div flex="33"> <md-button class="md-primary md-raised md-warn" ng-click="destroyPlayers()">DELETE ALL PLAYERS</md-button> </div> </md-card-content> </md-card>'),a.put("views/playersGraph.html",'<div class="graph-frame"> <div class="graph-frame__inner" ng-style="{width: width + \'px\', height: height + \'px\'}"> <div class="graph-frame__graph"></div> <h3 class="graph-frame__title md-headline" ng-style="{width: width}" layout="row" layout-align="center center" layout-padding><div>Players Progress</div></h3> <div class="graph-frame__dates">{{ startDate | date: \'shortDate\' }}</div> <div class="graph-frame__dates graph-frame__dates--last">{{ endDate | date: \'shortDate\' }}</div> </div> <div class="graph-frame__legend" ng-style="{width: width}" layout="row" layout-align="center center"> <div ng-repeat="player in players" ng-mouseover="hover(player)" ng-mouseleave="hover(player, true)" class="graph-frame__legend-item" ng-style="{\'background-color\': player.color}"> {{ player.name }} <span class="rank">({{player.rank}})</span> </div> </div> </div>'),a.put("views/playerticket.html",'<h1 hide-sm hide-md class="md-display-3" layout layout-align="center center"><span> Player &quot;{{ player.name }}&quot; </span></h1> <h1 hide-gt-md class="md-display-1" layout layout-align="center center"><span> Player &quot;{{ player.name}}&quot;</span></h1> <md-content class="md-whiteframe-z3 player-ticket"> <div layout="column" layout-padding> <div layout="row" layout-padding> <div class="label" flex="20"><b>Name</b></div> <div flex>{{player.name}}</div> </div> <div layout="row" layout-padding> <div class="label" flex="20"><b>ID</b></div> <div flex>{{playerid}}</div> </div> <div layout="row" layout-padding> <div flex="20" class="label"><b>Rank</b></div> <div flex>{{player.rank}}</div> </div> </div> <md-toolbar> <div class="md-toolbar-tools"> <h3><span>Game History</span></h3> </div> </md-toolbar> <md-list> <md-list-item class="md-2-line" ng-repeat="game in player.games"> <img ng-src="/images/won.31ed8309.svg" class="md-avatar" alt="WON" ng-if="game.won "> <img ng-src="/images/lost.8dfe7d47.svg" class="md-avatar" alt="WON" ng-if="!game.won "> <div class="md-list-item-text"> <h3>{{ game.time | date : \'medium\' }} ( {{ game.game }} )</h3> <p>Rank Change: {{ game.oldRank }} to {{ game.newRank }}</p> </div> </md-list-item> </md-list> </md-content>'),a.put("views/tablePlayerSlot.html",'<div class="inner" ng-class="{duplicate: slot.duplicate, \'md-whiteframe-z3\': raised }"> <md-select ng-if="players" ng-model="slot.player" md-on-close="updateGame()"> <md-option value="(none)">(None)</md-option> <md-option ng-repeat="player in players" value="{{player.name}}">{{player.name}}</md-option> </md-select> </div>'),a.put("views/tournament.html",'<h1 hide-sm hide-md class="md-display-3" layout layout-align="center center" xmlns="http://www.w3.org/1999/html"><span> Tournament</span></h1> <h1 hide-gt-md class="md-display-1" layout layout-align="center center"><span> Tournament</span></h1> <md-content layout-padding> <p>Simulate a series of games by randomly matching and determining winners and losers</p> </md-content> <md-toolbar md-scroll-shrink> <div class="md-toolbar-tools"> <h3> <span>Create Game Series</span> </h3> </div> </md-toolbar> <md-content> <form> <div layout="column"> <div layout layout-padding style="overflow: hidden" layout-sm="column"> <div flex="10" layout layout-align="center center" flex-sm="100"> <span class="md-body-1">Games</span> </div> <div flex> <md-slider min="0" max="100" ng-model="gameCount" aria-label="games"> </md-slider> </div> <div flex="20" layout layout-align="center center" flex-sm="100"> <input type="number" ng-model="gameCount"> </div> </div> </div> <div layout layout-padding layout-sm="column" style="overflow: hidden"> <div flex="33" flex-sm=""> <mdc-date-picker model="startDate" label="Start Date"> </div> <div flex="33" flex-sm=""> <mdc-date-picker model="endDate" label="End Date"> </div> </div> <div layout layout-padding> <div flex hide-sm></div> <div flex="20" flex-sm="100"> <md-button class="md-raised md-primary" ng-click="createGames()"> Create Games </md-button> </div> <div flex="20" flex-sm="100"> <md-button class="md-raised md-warn" ng-click="screwWithTime()"> Time Shift all games into the past. </md-button> </div> </div> </form> </md-content> <md-card layout-padding class="md-raised"> <img src="/images/back_to_the_future.aa7c9487.png" class="md-card-image" alt="Washed Out"> <md-card-content> <p>This page generates a set of games between the two points in the interface. However <b><i>in order to not create time paradoxes it always starts after the last recorded game</i></b>. Therefore it is a good idea to have the second date be some time in the future. </p> <p><b>HOWEVER:</b> since the &quot;Record a Game&quot; system always records a game using the current time, if you use this tournament page to generate a series of games in the future THEN record a single game in the present, you can generate a discontinuity between yourself getting better in the future from tournament games and having that rank (in a present game) and adjusting it (in the present) based on your (future adjusted) rank. </p> <h3 class="md-headline">Fixing the Space Time Continuum</h3> <p>You can fix this by shifting all games into the past (see the button above) -- but note that this will include not only the games generated in the tournament but any games generated individually in the Record A Game page. </p> <p>The very lightly tested TimeShift button finds the latest games and shifts all game dates back by the difference between the current date and the latest date. If any games are in the future, the latest game will be now. If no games are in the future no timeshifting occurs.</p> <p>To properly timeshift, you must timeshift <b><i>after</i></b> you generate tournament games. Once you do that, you can use individually added games based on the latest timeshifted game from the past. </p> </md-card-content> </md-card>')}]);